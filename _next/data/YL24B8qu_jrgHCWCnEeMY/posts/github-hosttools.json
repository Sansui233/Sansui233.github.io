{"pageProps":{"meta":{"title":"Github hosts 更新脚本(MAC)","date":"2021-08-07 08:00","tags":["科学上网"],"categories":"工具","description":"Github hosts 更新脚本(MAC)","keywords":"Github, hosts, 更新, 脚本, Mac"},"mdxcode":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    h2: \"h2\",\n    hr: \"hr\",\n    li: \"li\",\n    p: \"p\",\n    pre: \"pre\",\n    span: \"span\",\n    ul: \"ul\",\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"此工具已更新至 \", _jsx(_components.a, {\n        href: \"https://github.com/Sansui233/mac-githubhosts-autoupdate\",\n        children: \"Github\"\n      }), \"。\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"安装卸载脚本\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"自动定时运行\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"平时不占内存，运行时几乎不占内存\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"原文如下：\"\n    }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n      children: \"最近 Github 墙得越来越厉害了。写了个 Shell 工具，连不上的时候就更新一下。可以配合 Alfred 使用。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"使用的 host 源来自\", _jsx(_components.a, {\n        href: \"https://github.com/JohyC/Hosts\",\n        children: \"这里\"\n      }), \"。其实用 SwitchHosts 更新也行，但我真的讨厌 Electron App……麻了，现在听个歌写个笔记 1个多 G 的内存就没了。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"也可以用写成定时程序后台运行，加个 LaunchDaemon 文件就行，但，我不会打包 Mac App……文件这么散着分发也太 emmm，而且别人装起来也麻烦……\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"麻烦归麻烦还是要写的……\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"文件和说明已经上传到 \", _jsx(_components.a, {\n        href: \"https://github.com/Sansui233/mac-githubhosts-autoupdate\",\n        children: \"Github\"\n      }), \"。\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"下面这个文件保存取名为 \", _jsx(_components.code, {\n          children: \"hoststool\"\n        })]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"赋予执行权限 \", _jsx(_components.code, {\n          children: \"chmod +x hoststool\"\n        }), \"。如果为了执行起来方便，可以放进环境变量的目录（比如/usr/local/bin）\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"然后就可以使用 \", _jsx(_components.code, {\n          children: \"hoststool -u\"\n        }), \" 更新 host 了，运行结果会发系统通知。之前可以自己看看 hosts 内容有没有问题。这是有几率失败的，因为用的 gittee 的 host 源，经常会提示文件疑似违规……这种时候再请求一次就好了，第二次就不违规了。我也不知道为什么。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"（定时任务的部分在后面）\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-shell\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"#\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"!/bin/bash\"\n        }), \"\\r\\nshowHelp() {\\r\\n\\techo \\\"-u [source_url]\\tupdate github hosts. You can specify a custom host source\\\"\\r\\n\\techo \\\"-b\\tbackup /etc/hosts to /etc/hosts.backup\\\"\\r\\n\\techo \\\"-r\\trecover hosts.backup to hosts\\\"\\r\\n\\techo \\\"-f\\tlist files in /etc which contains \\\\\\\"hosts\\\\\\\"\\\"\\r\\n}\\r\\n\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n\\r\\n# \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"====== Main =====\"\n        }), \"\\r\\nif [ $# -eq 0 ]; then showHelp;exit 0;fi\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n\\r\\n# \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"CONF\"\n        }), \"\\r\\ndownload_dir=\\\"$HOME/etc/hoststool\\\"\\r\\ngithub_hosts=\\\"https://gitee.com/yuchi-shentang/GithubHosts/raw/main/hosts.txt\\\"\\r\\nif [ ! -d \\\"$download_dir\\\" ]; then\\r\\n  mkdir -p $download_dir\\r\\nfi\\r\\n\\r\\ncase \\\"$1\\\" in\\r\\n\\t-f)\\r\\n\\t\\tls /etc | grep hosts;\\r\\n\\t\\texit 0;;\\r\\n\\t-b) \\r\\n\\t\\tsudo cp /etc/hosts /etc/hosts.backup;\\r\\n\\t\\texit 0;;\\r\\n\\t-r) \\r\\n\\t\\tsudo cp /etc/hosts.backup /etc/hosts;\\r\\n\\t\\texit 0;;\\r\\n\\t-u) \\r\\n\\t\\tif [ $2 ]; then github_hosts=$2;fi\\r\\n\\t\\tcurl -o ${download_dir}/hosts ${github_hosts};\\r\\n\\t\\tif [ $? -ne 0 ]; then\\r\\n\\t\\t\\techo \\\"[ERROR] 获取远程 host 出错，请尝试更换 source 或检查 download_dir 读写权限\\\"\\r\\n\\t\\t\\tosascript -e 'display notification \\\"获取远程 host 出错，请尝试更换 source\\\" with title \\\"hoststool\\\"'\\r\\n\\t\\t\\texit 1\\r\\n\\t\\tfi\\r\\n\\t\\t\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n\\t\\t# \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"Validate host content length\"\n        }), \"\\r\\n\\t\\tlines=$(awk '{print NR}' ${download_dir}/hosts | tail -n1)\\r\\n\\t\\tif [ $lines -lt 10 ]\\r\\n\\t\\tthen\\r\\n\\t\\t\\techo '[ERRO] 远程 Github Hosts 无效（Gitee源不稳定），通常重试即可'\\r\\n\\t\\t\\tosascript -e 'display notification \\\"远程 Github Hosts 无效（Gitee源不稳定），通常重试即可\\\" with title \\\"hoststool\\\"'\\r\\n\\t\\t\\trm ${download_dir}/hosts\\r\\n\\t\\t\\texit 1\\r\\n\\t\\tfi\\r\\n\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n\\t\\t# \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"Remove old content\"\n        }), \"\\r\\n\\t\\tbegin=$(sed -n  '/# ==== Github Start ====/=' /etc/hosts | awk 'NR==1{print}')\\r\\n\\t\\tend=$(sed -n  '/# ==== Github End ====/=' /etc/hosts | awk 'END{print}')\\r\\n\\t\\techo \\\"Removing old hosts. Start at line \\\\\\\"${begin}\\\\\\\", End at line \\\\\\\"${end}\\\\\\\"\\\"\\r\\n\\t\\tcat /etc/hosts | sed \\\"${begin},${end}d\\\" > ${download_dir}/hosts.tmp\\r\\n\\t\\tif [ $? -ne 0 ]; then\\r\\n\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\t\\t\\t#\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"# Trip Failed\"\n          })\n        }), \"\\r\\n\\t\\t\\techo \\\"[INFO] 当前 Host中 无旧的 Github Host 标记可清除\\\"\\r\\n\\t\\telse\\r\\n\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\t\\t\\t#\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"# Trip Succeed, move result\"\n          })\n        }), \"\\r\\n\\t\\t\\techo \\\"[INFO] 清除旧的 Github Host 标记\\\"\\r\\n\\t\\t\\tsudo cp /etc/hosts /etc/hosts.backup && sudo cp ${download_dir}/hosts.tmp /etc/hosts;\\r\\n\\t\\tfi\\r\\n\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n\\t\\t# \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"Add new hosts\"\n        }), \"\\r\\n\\t\\tsudo bash -c \\\"echo '# ==== Github Start ====' >> /etc/hosts\\\" # Add github host\\r\\n\\t\\tif [ $? -ne 0 ]; then\\r\\n\\t\\t\\techo \\\"[ERROR] 无root权限，请尝试运行脚本手动输入密码\\\"\\r\\n\\t\\t\\tosascript -e 'display notification \\\"无root权限，请尝试运行脚本手动输入密码\\\" with title \\\"hoststool\\\"'\\r\\n\\t\\t\\trm ${download_dir}/hosts.tmp\\r\\n\\t\\t\\trm ${download_dir}/hosts\\r\\n\\t\\t\\texit 1;\\r\\n\\t\\tfi\\r\\n\\t\\tsudo bash -c \\\"echo \\\\\\\"# Updated at $(date)\\\\\\\" >> /etc/hosts\\\" # Add github host\\r\\n\\t\\tsudo bash -c \\\"cat ${download_dir}/hosts >> /etc/hosts\\\";\\r\\n\\t\\tsudo bash -c \\\"echo '# ==== Github End ====' >> /etc/hosts\\\"\\r\\n\\t\\trm ${download_dir}/hosts.tmp\\r\\n\\t\\trm ${download_dir}/hosts\\r\\n\\r\\n\\t\\techo \\\"[INFO] Github Hosts 块更新于 $(date)\\\"\\r\\n\\t\\tosascript -e 'display notification \\\"Github Hosts 已更新\\\" with title \\\"hoststool\\\"'\\r\\n\\t\\texit 0;;\\r\\n\\t-h|--help)\\r\\n\\t\\tshowHelp;\\r\\n\\t\\texit 0;;\\r\\n\\t*)\\r\\n\\t\\techo \\\"Unknown command\\\";\\r\\n\\t\\tshowHelp;\\r\\n\\t\\texit 1;;\\r\\nesac\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"定时\",\n      children: \"定时\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"保存以下文件为 \", _jsx(_components.code, {\n        children: \"hoststool.plist\"\n      }), \"。\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-plist\",\n        children: [_jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"<?xml version=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"1.0\\\"\"\n          }), \" encoding=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"UTF-8\\\"\"\n          }), \"?>\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-meta\",\n          children: [\"<!DOCTYPE \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"plist\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"PUBLIC\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"-//Apple//DTD PLIST 1.0//EN\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\\"\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"plist\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"version\"\n          }), \"=\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"1.0\\\"\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"dict\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"Label\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"hoststool\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"ProgramArguments\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"array\"\n          }), \">\"]\n        }), \"\\r\\n  \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"/usr/local/bin/hoststool\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"\\r\\n  \", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"-u\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"array\"\n          }), \">\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"RunAtLoad\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"true\"\n          }), \"/>\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"StartInterval\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"integer\"\n          }), \">\"]\n        }), \"3600\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"integer\"\n          }), \">\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"StandardOutPath\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"/Library/Logs/hoststool.log\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"StandardErrorPath\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"key\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"<\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"/Library/Logs/hoststool.log\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"string\"\n          }), \">\"]\n        }), \"\\r\\n\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"dict\"\n          }), \">\"]\n        }), \"\\r\\n\", _jsxs(_components.span, {\n          className: \"hljs-tag\",\n          children: [\"</\", _jsx(_components.span, {\n            className: \"hljs-name\",\n            children: \"plist\"\n          }), \">\"]\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"把 \", _jsx(_components.code, {\n        children: \"/usr/local/bin\"\n      }), \" ，改成你存放脚本的路径。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"时间间隔为 3600 秒，可以自己修改。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"然后执行\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-shell\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"$ \"\n        }), _jsxs(_components.span, {\n          className: \"bash\",\n          children: [\"sudo \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"cp\"\n          }), \" hoststool.plist /Library/LaunchDaemons\"]\n        }), \"\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n$ \"\n        }), _jsxs(_components.span, {\n          className: \"bash\",\n          children: [\"sudo \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"chown\"\n          }), \" root:admin /Library/LaunchDaemons/hoststool.plist\"]\n        }), \"\\r\", _jsx(_components.span, {\n          className: \"hljs-meta prompt_\",\n          children: \"\\n$ \"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \"sudo launchctl load -w /Library/LaunchDaemons/hoststool.plist\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"执行完就会立刻运行一次脚本。由于定时任务是 root 用户不是个人用户，不会有通知，可以去 Console 看 log。\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","excerpt":" 此工具已更新至 [Github](https://github.com/Sansui233/mac-githubhosts-autoupdate)。  - 安装卸载脚本 - 自动定时运行 - 平时不占内存，运行时几乎不占内存  原文如下：  ------  最近 Github 墙得越来","prevPost":{"title":"纯函数与算法","link":"/posts/pure-function"},"nextPost":{"title":"网盘目录程序比较","link":"/posts/网盘目录程序比较"},"headings":[{"title":"定时","rank":1,"id":"定时"}]},"__N_SSG":true}