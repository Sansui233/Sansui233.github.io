const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/waline-DixnivI2.js","assets/chunk-JMJ3UQ3L-BVFOw7ai.js","assets/i18nInstance-DPKwMV5N.js","assets/waline-CU-IWbQZ.css"])))=>i.map(i=>d[i]);
import{c as y,u as E,d as M,t as R,_ as F}from"./throttle-DwQFwEus.js";import{a as o,p as e,y as w,w as B}from"./chunk-JMJ3UQ3L-BVFOw7ai.js";import{s as z}from"./i18nInstance-DPKwMV5N.js";import{F as _,T as D,X as O,M as V,a as H}from"./MDXComponent-BzBGnsZ7.js";import{u as P,p as A}from"./use-date-i18n-CH95KIPY.js";import{F as W}from"./folder-Dg4Z__4I.js";const Y=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],X=y("arrow-left",Y);const q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],U=y("arrow-right",q);const G=[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]],J=y("arrow-up-to-line",G);const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Q=y("circle-alert",K);const Z=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ee=y("eye",Z);const te=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],se=y("menu",te);function ne(r,t,s,n){o.useEffect(()=>(document.addEventListener(r,t,s),()=>{document.removeEventListener(r,t,s)}),[r,t,s,...n||[]])}function re(){const[r,t]=o.useState(globalThis.innerHeight);return o.useEffect(()=>{const s=()=>{t(globalThis.innerHeight)};return globalThis.addEventListener("resize",s),()=>{globalThis.removeEventListener("resize",s)}},[]),r}function oe(){const[r,t]=o.useState(globalThis.innerWidth);return o.useEffect(()=>{const s=()=>{t(globalThis.innerWidth)};return globalThis.addEventListener("resize",s),()=>{globalThis.removeEventListener("resize",s)}},[]),r}function ae({height:r="100px",width:t="100%",borderRadius:s="0.5rem",className:n}){return e.jsx("div",{className:`animate-shimmer bg-[linear-gradient(45deg,#55555525_25%,#bbbbbb25_50%,#55555525_75%)] bg-size-[400%_200%] ${n||""}`,style:{height:r,width:t,borderRadius:s,animation:"shimmer 5s infinite linear"},children:e.jsx("style",{children:`
        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }
      `})})}function ie({height:r="100px",width:t="100%",borderRadius:s="0.5rem",text:n="Load Failed",className:u}){return e.jsxs("div",{className:`flex items-center justify-center bg-gray-500/15 p-4 text-gray-400/40 ${u||""}`,style:{height:r,width:t,borderRadius:s},children:[e.jsx(Q,{className:"mr-2 inline-block h-6 w-6"}),e.jsx("span",{className:"text-xl font-semibold",children:n})]})}function le(r){const[t,s]=o.useState(!1);o.useEffect(()=>{s(!0)},[]);const[n,u]=o.useState(!1),[d,a]=o.useState(!0),[h,l]=o.useState(!1),c=o.useRef(null),m=o.useRef(null),[i,f]=o.useState({width:"100%",height:"auto"}),[b,g]=o.useState({filter:"blur(12px)",height:"0",margin:"0"}),v=oe(),j=re();o.useEffect(()=>{if(!t||!c.current)return;const x=()=>{a(!1),g({cursor:"zoom-in",filter:"blur(0px)",transform:"scale(1) translate(0,0)",height:"auto"})},p=c.current;return p.complete?x():(p.onload=x,p.onerror=()=>{a(!1),l(!0),g({display:"none"})}),()=>{p.onload=null,p.onerror=null}},[t]),ne("scroll",()=>{n&&(u(!1),N())},!1,[n]);const N=o.useCallback(()=>{if(n&&c.current&&m.current)g(x=>({...x,transform:"scale(1) translate(0,0)",cursor:"zoom-in"})),setTimeout(()=>{g(x=>({...x,zIndex:"auto"})),f(x=>({...x,height:"auto",zIndex:"auto"}))},300);else if(c.current&&m.current){const x=c.current.getBoundingClientRect(),p=m.current.getBoundingClientRect(),$=x.width,k=x.height,I=-(x.y-j/2+k/2),S=x.x-2*p.x-p.width/2+v/2,L=Math.min(v/$,j/k)-.05;f(T=>({...T,height:k+"px"})),g(T=>({...T,transform:`translateX(${S}px) translateY(${I}px) scale(${L})`,cursor:"zoom-out"}))}else console.error("[Error] img nothing happened, ref not inited");u(!n)},[n,j,v]);if(t)return e.jsxs("div",{ref:m,className:"relative my-6",style:{...i},children:[d&&e.jsx(ae,{height:"100px",width:"100%"}),h&&e.jsx(ie,{height:"100px",width:"100%"}),n?e.jsx("div",{className:"fixed inset-0 z-20 cursor-zoom-out backdrop-blur",onClick:N}):null,e.jsx("img",{ref:c,loading:"lazy",onClick:N,style:{...b,position:"relative",transition:"transform .3s ease, filter 1s ease",zIndex:n?21:"auto"},...r})]})}function ce({isViewing:r,onTocToggle:t}){const s=n=>{n.stopPropagation(),window.scrollTo({top:0,behavior:"smooth"})};return e.jsxs(e.Fragment,{children:[e.jsx(_,{Icon:se,onClick:n=>{n.stopPropagation(),t()},className:"max-lg:block hidden",style:r?{bottom:"5.25rem"}:void 0}),r&&e.jsx(_,{Icon:J,onClick:s})]})}function me({prevPost:r,nextPost:t}){return e.jsxs("div",{className:"my-16 flex flex-wrap items-center justify-between",children:[r?e.jsx("div",{className:"flex-1",children:e.jsxs(w,{to:`/posts/${r.slug}`,className:"group inline-flex items-center py-1",children:[e.jsx(X,{size:"1em",className:"-translate-y-px"}),e.jsxs("span",{className:"relative mx-2",children:[r.title,e.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 rounded bg-accent-hover transition-[width] duration-1000 ease-[cubic-bezier(0.34,0.04,0.03,1.4)] group-hover:w-full"})]})]})}):e.jsx("div",{className:"flex-1"}),t?e.jsx("div",{className:"flex-1",children:e.jsxs(w,{to:`/posts/${t.slug}`,className:"group inline-flex items-center justify-end py-1 w-full",children:[e.jsxs("span",{className:"relative mx-2",children:[t.title,e.jsx("span",{className:"absolute bottom-0 left-0 h-0.5 w-0 rounded bg-accent-hover transition-[width] duration-1000 ease-[cubic-bezier(0.34,0.04,0.03,1.4)] group-hover:w-full"})]}),e.jsx(U,{size:"1em",className:"-translate-y-px"})]})}):e.jsx("div",{className:"flex-1"})]})}function ue({date:r,categories:t,tags:s=[]}){const{dateI18n:n}=P(),u=n(A(r),"dateNatural");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 text-center text-sm font-semibold text-[#989898]",children:u}),e.jsx("div",{className:"mt-4 mb-6 pb-6 text-center text-sm font-semibold",children:e.jsxs("div",{className:"inline-block max-w-1/2",children:[t&&e.jsx("span",{className:"pr-2 text-sm leading-6",children:e.jsxs(w,{to:`/categories/${t}`,className:"text-text-primary hover:text-accent transition-colors",children:[e.jsx(W,{size:"1.1em",className:"mr-0.5 ml-2 inline pb-0.5"}),t]})}),s&&s.length>0&&e.jsx("span",{className:"text-sm leading-none",children:s.map(d=>e.jsxs(w,{to:`/tags/${d}`,className:"bg-tag-bg text-text-secondary hover:bg-accent-hover m-px inline-block rounded-full px-2 py-1 transition-colors",children:[e.jsx(D,{size:"0.875em",className:"mr-0.5 inline"}),d]},d))})]})})]})}function de({flatItems:r,currentIndex:t,isViewing:s,isMobileOpen:n,onClose:u,onScrollTo:d}){const a=s&&!n,{t:h}=E();return e.jsxs("aside",{className:`/* Desktop positioning */ fixed left-[78%] z-5 w-72 max-w-72 overflow-auto transition-[top] duration-300 xl:animate-[fadeInRight_0.3s_ease] ${a?"top-16":"top-32"} ${a?"max-h-[calc(100vh-4rem)]":"max-h-[calc(100vh-8rem)]"} /* Tablet: narrower */ /* Mobile: drawer from bottom/right */ max-lg:bg-bg max-lg:shadow-float-menu max-lg:border-ui-line-gray-3 max-xl:left-[76%] max-xl:w-60 max-lg:top-auto max-lg:right-2 max-lg:bottom-34 max-lg:left-auto max-lg:max-h-[calc(100vh-8rem-9rem)] max-lg:w-75 max-lg:rounded-lg max-lg:border max-lg:transition-all max-lg:duration-300 ${n?"max-lg:translate-x-0 max-lg:opacity-100":"max-lg:pointer-events-none max-lg:translate-x-full max-lg:opacity-0"} /* Small mobile: full width drawer from bottom */ max-sm:right-[2%] max-sm:bottom-0 max-sm:max-h-[60vh] max-sm:w-[96%] max-sm:max-w-none ${n?"max-sm:translate-x-0 max-sm:translate-y-0":"max-sm:translate-x-0 max-sm:translate-y-full"} `,children:[e.jsxs("div",{className:"max-lg:bg-bg sticky top-0 z-9 mb-2 pt-4 pr-4 pb-2 pl-8 text-xl font-bold max-lg:pr-4 max-lg:pl-8",children:[h("ui.toc"),e.jsx("button",{onClick:l=>{l.stopPropagation(),u()},className:`text-text-gray-2 hover:text-accent float-right hidden cursor-pointer text-[1rem] max-lg:block ${!n&&"invisible"} `,children:e.jsx(O,{size:"1.5em"})})]}),e.jsx("nav",{className:"pr-4 pb-4 pl-8 max-lg:px-6 max-lg:pr-4 max-lg:pl-8",children:r.length>0?e.jsx("div",{className:"relative",children:r.map((l,c)=>e.jsx("a",{href:`#${l.id}`,onClick:m=>{m.preventDefault(),d(c)},style:{paddingLeft:`${l.depth-1}em`},className:`toc-link ${t===c?"active":""}`,children:e.jsx("span",{className:"transition-shadow duration-500",children:l.title})},l.id))}):e.jsx("span",{className:"text-sm opacity-60",children:"这是一篇没有目录的文章。"})})]})}const xe=(r,t)=>{const[s,n]=o.useState(null);return o.useEffect(()=>{n(e.jsx(V,{code:r,components:t}))},[r]),s},he=93;function pe(r,t){const[s,n]=o.useState(-1),[u,d]=o.useState(!1),a=o.useRef([]);o.useEffect(()=>{const l=()=>{const i=r.map(f=>{const b=document.getElementById(f.id);return b?b.getBoundingClientRect().top+window.scrollY-he:void 0});a.current=i};l();const c=M(l,200),m=new ResizeObserver(c);return t.current&&m.observe(t.current),()=>{m.disconnect()}},[t]),o.useEffect(()=>{const l=R(()=>{if(!a.current||a.current.length===0)return;const c=globalThis.scrollY;c>300?d(!0):d(!1);const m=c+20;for(let i=0;i<a.current.length;i++){if(i===0&&m<a.current[i]){n(-1);break}if(a.current[i]&&i+1<a.current.length&&a.current[i+1]){if(m>=a.current[i]&&m<a.current[i+1]){n(i);break}}else if(a.current[i]&&i+1===a.current.length&&m>=a.current[i]){n(i);break}}},50);return window.addEventListener("scroll",l),()=>{window.removeEventListener("scroll",l)}},[]);const h=o.useCallback(l=>{a.current[l]&&window.scrollTo({top:a.current[l],behavior:"smooth"})},[a]);return{currentIndex:s,isViewing:u,scrollTo:h}}const ge=()=>F(()=>import("./waline-DixnivI2.js"),__vite__mapDeps([0,1,2,3])),fe=o.lazy(ge);function Te({loaderData:r}){const{post:t}=r,s=t.description||t.excerpt?.slice(0,160)||"",n=`${z.domain}/posts/${t.slug}`,u=[...t.keywords||[],...t.tags||[],t.categories].filter(Boolean).join(", ");return[{title:t.title},{name:"description",content:s},{name:"keywords",content:u},{name:"author",content:z.author},{property:"og:title",content:t.title},{property:"og:description",content:s},{property:"og:type",content:"article"},{property:"og:url",content:n},...t.cover?[{property:"og:image",content:t.cover.src}]:[],{property:"article:published_time",content:t.date},{property:"article:author",content:z.author},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:t.title},{name:"twitter:description",content:s},...t.cover?[{name:"twitter:image",content:t.cover.src}]:[]]}const ze=B(function({loaderData:t}){const{post:s,prevPost:n,nextPost:u}=t,d=o.useRef(null),[a,h]=o.useState(!1),l=o.useMemo(()=>C(s.toc||[]),[s.toc]),{t:c}=E(),{currentIndex:m,isViewing:i,scrollTo:f}=pe(l,d),b=o.useMemo(()=>({img:le}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto w-170 px-5 py-15 max-xl:w-[calc(100%-480px)] max-xl:max-w-170 max-lg:w-auto max-lg:max-w-170 max-sm:w-full max-sm:py-12",children:[e.jsxs("article",{children:[e.jsx("h1",{className:"mt-0 mb-0 text-center",children:s.title}),e.jsx(ue,{date:s.date,categories:s.categories,tags:s.tags}),e.jsx("section",{children:e.jsx(be,{post:s,t:c})}),e.jsx("div",{ref:d,className:"markdown-wrapper",children:xe(s.content_jsx,b)}),e.jsx("section",{children:e.jsxs("div",{className:"mt-16 text-right text-sm opacity-50",children:["更新于 ",s.date.split("T")[0]]})}),e.jsx(me,{prevPost:n,nextPost:u})]}),e.jsx(o.Suspense,{fallback:e.jsx("div",{children:"Loading comments..."}),children:e.jsx(fe,{})})]}),e.jsx(de,{flatItems:l,currentIndex:m,isViewing:i,isMobileOpen:a,onClose:()=>h(!1),onScrollTo:f}),e.jsx(ce,{isViewing:i,onTocToggle:()=>h(g=>!g)})]})});function be({post:r,t}){return e.jsxs("div",{className:"text-right text-sm opacity-50",children:[e.jsx(ee,{size:"1em",className:"mr-1 mb-0.5"}),e.jsx("span",{className:"waline-pageview-count mr-1","data-path":`/posts/${encodeURI(r.slug)}`}),t("ui.postView"),e.jsxs("span",{className:"hover:text-accent cursor-pointer",onClick:()=>{const s=document.getElementById("waline");s&&s.scrollIntoView({behavior:"smooth"})},children:[e.jsx(H,{size:"1em",className:"mr-1 mb-0.5 ml-4"}),e.jsx("span",{className:"waline-comment-count mr-1","data-path":`/posts/${encodeURI(r.slug)}`}),t("ui.postComment")]})]})}function C(r,t=1){const s=[];for(const n of r)s.push({title:n.title,id:n.url.replace("#",""),depth:t}),n.items?.length&&s.push(...C(n.items,t+1));return s}export{ze as default,Te as meta};
