import{a as r,p as e,y as N}from"./chunk-JMJ3UQ3L-BVFOw7ai.js";import{P as k,u as E}from"./use-search-CGJ_0Tiw.js";import{u as _,d as R}from"./throttle-DwQFwEus.js";import"./i18nInstance-DPKwMV5N.js";function $({outSetSearch:x,outIsShow:i,iconEle:d}){const[h,w]=r.useState([]),u=r.useRef(null),p=r.useRef(null),{t:c}=_(),y=r.useCallback(async()=>({data:await(await fetch(`/data/${k}`)).json(),fields:["title","tags","description","keywords","content"],buildResult:(s,n)=>({id:s.id,title:s.title,matches:n})}),[]),{searchStatus:f,search:m}=E({inputRef:p,setRes:w,initData:y}),b=r.useMemo(()=>R(()=>{m()},300),[m]),l=r.useCallback(()=>{x(!1)},[x]);r.useEffect(()=>{if(!i)return;function t(s){const n=u.current&&u.current.contains(s.target),o=d.current&&d.current.contains(s.target);!n&&!o&&l()}function a(s){s.key==="Escape"&&l()}return document.addEventListener("pointerdown",t,!1),document.addEventListener("keydown",a,!1),()=>{document.removeEventListener("pointerdown",t,!1),document.removeEventListener("keydown",a,!1)}},[d,l,i]),r.useEffect(()=>{i&&p.current?.focus()},[i]);const j=()=>{b()};function v(t,a){if(!a)return t;typeof a=="string"&&(a=[a]);const s=new RegExp(`(${a.join("|")})`,"gi"),n=t.split(s);return e.jsx(e.Fragment,{children:n.map((o,g)=>s.test(o)?e.jsx("mark",{className:"text-accent bg-transparent",children:o},g):e.jsx("span",{children:o},g))})}return e.jsxs("div",{ref:u,className:`bg-bg border-ui-line-gray-2 fixed top-13.75 right-0 z-11 m-[0_10px] w-96 overflow-hidden rounded-xl border shadow-[0_0_12px_var(--shadow-bg)] transition-all duration-300 ease-out max-[580px]:max-h-[50%] max-[580px]:w-[96%] ${i?"visible translate-y-0 opacity-100":"pointer-events-none invisible -translate-y-2.5 opacity-0"} `,children:[e.jsx("div",{className:"bg-bg sticky top-0 p-4 pb-0",children:e.jsx("input",{type:"text",placeholder:c("ui.searchPlaceholder"),ref:p,onInput:j,className:"bg-bg text-text-primary w-full rounded-none border-none focus:outline-none focus-visible:outline-none"})}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-4 py-2",children:f.isSearch==="ready"?e.jsx("div",{className:"text-sm opacity-50",children:e.jsx("div",{className:"text-text-gray overflow-hidden text-sm whitespace-nowrap",children:c("ui.searchHint")})}):f.isSearch==="searching"?e.jsx("div",{className:"text-sm opacity-50",children:e.jsx("div",{className:"text-text-gray overflow-hidden text-sm whitespace-nowrap",children:c("ui.searching")})}):h.length===0?e.jsx("div",{className:"text-sm opacity-50",children:e.jsx("div",{className:"text-text-gray overflow-hidden text-sm whitespace-nowrap",children:c("ui.noResults")})}):h.map((t,a)=>{const s=t.id.substring(0,t.id.lastIndexOf("."))||t.id;return e.jsxs(N,{to:`/posts/${s}`,onClick:()=>l(),className:"group block py-1.5 pl-4",children:[e.jsx("span",{className:"before:text-accent relative transition-shadow duration-500 group-hover:shadow-[inset_0_-0.5em_0_var(--accent-hover)] before:absolute before:-left-3.5 before:content-['â€¢']",children:v(t.title,t.matches?.map(n=>n.word))}),t.matches?.map(n=>n.excerpt&&e.jsx("div",{className:"text-text-gray overflow-hidden text-sm whitespace-nowrap",children:v(n.excerpt,n.word)},n.word))]},a)})})]})}export{$ as default};
