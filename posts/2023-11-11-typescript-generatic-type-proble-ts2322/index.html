<!DOCTYPE html><html lang="zh"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EDE15EB3W8"></script><title>关于 typescript 泛型中返回值类型约束的问题</title><meta name="description" content="最近遇到这么一个需求。

定义一个函数接口，要求其返回值类型是 type A 的任意超集。

于是我按直觉写下了：
type A  = { a: string }
type FuncA  = &lt;T extends A&gt;() =&gt; T
const f: FuncA = () =&gt; {
  return { a: &quot;ok&quot;"/><meta name="keywords" content="typescript, ts, generic type, ts2322，泛型约束, typescript, 学习"/><meta name="author" content="Sansui"/><meta property="og:title" content="关于 typescript 泛型中返回值类型约束的问题"/><meta property="og:description" content="最近遇到这么一个需求。

定义一个函数接口，要求其返回值类型是 type A 的任意超集。

于是我按直觉写下了：
type A  = { a: string }
type FuncA  = &lt;T extends A&gt;() =&gt; T
const f: FuncA = () =&gt; {
  return { a: &quot;ok&quot;"/><meta property="og:type" content="article"/><meta property="og:url" content="https://sansui233.com/posts/2023-11-11-typescript-generatic-type-proble-ts2322"/><meta property="article:published_time" content="2023-11-11T14:26:09.000Z"/><meta property="article:author" content="Sansui"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="关于 typescript 泛型中返回值类型约束的问题"/><meta name="twitter:description" content="最近遇到这么一个需求。

定义一个函数接口，要求其返回值类型是 type A 的任意超集。

于是我按直觉写下了：
type A  = { a: string }
type FuncA  = &lt;T extends A&gt;() =&gt; T
const f: FuncA = () =&gt; {
  return { a: &quot;ok&quot;"/><link rel="modulepreload" href="/assets/manifest-4c8363cb.js"/><link rel="modulepreload" href="/assets/entry.client-DkTTQJrl.js"/><link rel="modulepreload" href="/assets/chunk-JMJ3UQ3L-BVFOw7ai.js"/><link rel="modulepreload" href="/assets/index-HqdIF0eP.js"/><link rel="modulepreload" href="/assets/root-C0ep9fuI.js"/><link rel="modulepreload" href="/assets/i18nInstance-DPKwMV5N.js"/><link rel="modulepreload" href="/assets/i18n-C8hHMX00.js"/><link rel="modulepreload" href="/assets/RootLayout-CHttVE2X.js"/><link rel="modulepreload" href="/assets/throttle-DwQFwEus.js"/><link rel="modulepreload" href="/assets/index-CEQRVl7u.js"/><link rel="modulepreload" href="/assets/use-appstate-wXf1X0hJ.js"/><link rel="modulepreload" href="/assets/posts._slug-DRWishpF.js"/><link rel="modulepreload" href="/assets/MDXComponent-BzBGnsZ7.js"/><link rel="modulepreload" href="/assets/use-date-i18n-CH95KIPY.js"/><link rel="modulepreload" href="/assets/folder-Dg4Z__4I.js"/><script>
              (function() {
                var theme = localStorage.getItem("theme");
                if (theme === "system" || !theme) {
                  theme = window.matchMedia("(prefers-color-scheme: dark)").matches
                    ? "dark" : "light";
                }
                console.debug("theme", theme);
                document.documentElement.classList.add(theme);
              })();
            </script><link rel="stylesheet" href="/assets/root-DLwv1eWL.css"/><link rel="stylesheet" href="/assets/posts-CMWrxi_F.css"/><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-EDE15EB3W8', {
                page_path: window.location.pathname,
              });
            </script></head><body><div id="initial-progress" style="position:fixed;top:0;left:0;height:2px;width:0;background:var(--accent);z-index:9999;animation:progressLoading 3s ease-out forwards"></div><!--$?--><template id="B:0"></template><!--/$--><section class="bg-bg/90 fixed inset-0 z-8 h-full w-full overflow-auto backdrop-blur-[6px] transition-all duration-500 ease-[cubic-bezier(0.46,0,0.08,1.11)] pointer-events-none opacity-0 "><div class="relative mx-auto pt-32 pb-23 text-center font-bold"><h1 class="
    transition-all duration-1000 ease-out transform
    delay-0
    opacity-0 -translate-y-8
  "><span class="relative inline-block">SANSUI的博客<span class="bg-accent-hover absolute bottom-0 left-0 -z-10 h-[0.5em] w-full rounded-[0.5em] mix-blend-overlay"></span></span></h1><div class="mt-8 
    transition-all duration-1000 ease-out transform
    delay-100
    opacity-0 -translate-y-8
  "><span class="hover:text-accent-hover relative inline-block cursor-pointer text-[1.625rem] leading-11 transition-transform duration-300 ease-out hover:scale-110">系统外观</span></div><div class="mt-4 
    transition-all duration-1000 ease-out transform
    delay-200
    opacity-0 -translate-y-8
  "><span class="hover:text-accent-hover relative inline-block cursor-pointer text-[1.625rem] leading-11 transition-transform duration-300 ease-out hover:scale-110"><a href="/categories" data-discover="true">分类标签</a></span></div><div class="mt-4 
    transition-all duration-1000 ease-out transform
    delay-300
    opacity-0 -translate-y-8
  "><span class="hover:text-accent-hover relative inline-block cursor-pointer text-[1.625rem] leading-11 transition-transform duration-300 ease-out hover:scale-110"><a href="/atom.xml">RSS</a></span></div><div class="pt-12 text-[10px] font-normal 
    transition-all duration-1000 ease-out transform
    delay-400
    opacity-0 -translate-y-8
  "><div class="my-4 flex items-center justify-center"><a href="https://github.com/sansui233" class="text-text-primary hover:text-accent-hover mx-1 transition-colors [&amp;&gt;svg]:h-6 [&amp;&gt;svg]:w-6" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><a href="mailto:sansuilnm@gmail.com" class="text-text-primary hover:text-accent-hover mx-1 transition-colors [&amp;&gt;svg]:h-6 [&amp;&gt;svg]:w-6" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail" aria-hidden="true"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path><rect x="2" y="4" width="20" height="16" rx="2"></rect></svg></a><a href="/rss" class="text-text-primary hover:text-accent-hover mx-1 transition-colors [&amp;&gt;svg]:h-6 [&amp;&gt;svg]:w-6" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss" aria-hidden="true"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="mx-auto my-4 leading-relaxed">© Sansui 2026<br/>All rights reserved</div></div></div><div class="fixed top-5.5 right-5 z-5 h-5 w-6"><div class="flex flex-col justify-between cursor-pointer " style="width:1rem;height:1rem" aria-expanded="true" aria-label="Toggle menu"><div class="h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out opacity-0"></div><div class="relative h-0.5 w-full"><div class="absolute top-0 left-0 h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out rotate-45"></div><div class="absolute top-0 left-0 h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out -rotate-45"></div></div><div class="h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out opacity-0"></div></div></div></section><header class="bg-bg/60 fixed z-10 box-content flex h-15.75 w-full items-center justify-between backdrop-blur-[6px] transition-transform duration-500 ease-out translate-y-0 "><div class="w-52.5 flex-auto items-center justify-start font-semibold max-md:w-25"><a class="flex items-center px-4" href="/" data-discover="true"><svg fill="currentColor" id="flat-neko" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="36" class="shrink-0"><path d="m68.24,44.97c.54-.13.86-.68.73-1.21m0,0c-.13-.54-.68-.86-1.21-.73l-4.61,1.15c1.06-5.18.9-11.77-1.14-20.18,0-7-1.45-14.23-3.24-14.91-1.99-.75-11.76,5.91-12.76,8.91-7-2-13-2-20,0-1-3-10.77-9.66-12.76-8.91-1.79.67-3.24,7.91-3.24,14.91-2.05,8.41-2.2,15-1.14,20.18l-4.61-1.15c-.54-.13-1.08.19-1.21.73-.13.54.19,1.08.73,1.21l5.64,1.41c.33,1.14.72,2.21,1.18,3.2l-4.67.42c-.55.05-.96.54-.91,1.09.05.52.48.91,1,.91.03,0,.06,0,.09,0l5.49-.5c.44.75.92,1.46,1.42,2.11l-4.32,1.44c-.52.17-.81.74-.63,1.26.14.42.53.68.95.68.1,0,.21-.02.32-.05l5.08-1.69c6.8,7.11,17.32,7.75,21.6,7.75s14.8-.63,21.6-7.75l5.08,1.69c.11.04.21.05.32.05.42,0,.81-.26.95-.68.17-.52-.11-1.09-.63-1.26l-4.32-1.44c.51-.66.98-1.36,1.42-2.11l5.49.5s.06,0,.09,0c.51,0,.95-.39,1-.91.05-.55-.36-1.04-.91-1.09l-4.67-.42c.45-.99.84-2.06,1.18-3.2l5.64-1.41m-47.24,1.03c-5-1-7-5-6-10,.81-4.04,4.59-7.63,9-7,4.39.63,6.81,4.04,6.64,8.74-.18,4.98-4.64,9.26-9.64,8.26Zm21.45,1.28c-.64.32-1.36.48-2.09.48-.67,0-1.36-.14-2.01-.41-.94-.39-1.74-1.01-2.35-1.83-.61.81-1.41,1.44-2.35,1.83-1.37.57-2.87.54-4.1-.07-.49-.25-.69-.85-.45-1.34.25-.49.85-.69,1.34-.45.7.35,1.61.36,2.44.02,1.01-.42,1.78-1.28,2.16-2.44.03-.09.08-.17.13-.25-.7-.31-1.18-1.01-1.18-1.82,0-1.1.9-2,2-2s2,.9,2,2c0,.81-.49,1.51-1.18,1.82.05.08.1.16.13.25.38,1.15,1.15,2.02,2.16,2.44.83.34,1.74.34,2.44-.02.49-.25,1.09-.05,1.34.45s.05,1.09-.45,1.34Zm8.55-1.28c-5,1-9.46-3.28-9.64-8.26-.17-4.71,2.25-8.11,6.64-8.74,4.41-.63,8.19,2.96,9,7,1,5-1,9-6,10Z"></path><path d="m26,33c-.55,0-1-.45-1-1,0-.45.3-.81.7-.94-.16-.09-.32-.19-.5-.25-2.2-.81-5.2.19-6.82,3.53-1.6,3.29-1.17,7.39,2.48,8.79,3.31,1.27,7.01-.77,7.53-4.63.35-2.62-.16-4.96-1.41-6.41-.04.51-.46.92-.98.92Z"></path><path d="m53.62,34.34c-.45-.93-1.02-1.66-1.64-2.24-.05.51-.46.9-.98.9-.55,0-1-.45-1-1,0-.4.24-.74.57-.9-1.27-.63-2.63-.72-3.78-.3-2.52.92-3.68,4.05-3.19,7.69.52,3.85,4.23,5.9,7.53,4.63,3.64-1.4,4.07-5.49,2.48-8.79Z"></path></svg><span class="px-2 max-md:hidden">Sansui的博客</span></a></div><nav class="relative flex max-w-[50%] flex-[2_1_auto] items-center justify-evenly tracking-wide max-[580px]:hidden min-[580px]:max-w-97.5"><div class="bg-accent-hover pointer-events-none absolute top-[1.1em] -z-10 h-[0.4em] w-[0.4em] rounded-full" style="opacity:0"></div><div class="bg-accent-hover pointer-events-none absolute top-[1.1em] -z-10 h-[0.4em] rounded-[0.5em] " style="opacity:0"></div><div class="px-2 pt-0.5 font-semibold"><a class="hover:text-accent relative transition-colors duration-300 text-text-primary" href="/" data-discover="true">文章</a></div><div class="px-2 pt-0.5 font-semibold"><a class="hover:text-accent relative transition-colors duration-300 " href="/memos" data-discover="true">说说</a></div><div class="px-2 pt-0.5 font-semibold"><a class="hover:text-accent relative transition-colors duration-300 " href="/about" data-discover="true">关于</a></div></nav><div class="flex w-52.5 flex-auto items-center justify-end max-md:w-25 [&amp;&gt;div]:mr-4"><div class="relative min-w-14.25 text-xl font-semibold min-[580px]:hidden"><div class="absolute -top-2 left-0 w-full pt-10 transition-all duration-300 invisible border-transparent "><a class="text-text-secondary my-2 block px-1 pb-1 pl-2.75 transition-all duration-500 pointer-events-none opacity-0 blur-md " href="/memos" data-discover="true">说说</a><a class="text-text-secondary my-2 block px-1 pb-1 pl-2.75 transition-all duration-500 pointer-events-none opacity-0 blur-md " href="/about" data-discover="true">关于</a></div><button class="text-text-primary relative flex items-center px-3">文章<svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down -mr-2" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button></div><div class="cursor-pointer transition-colors duration-300   hover:text-accent-hover"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search" aria-hidden="true"><path d="m21 21-4.34-4.34"></path><circle cx="11" cy="11" r="8"></circle></svg></div><div class="mr-5 w-5.5"><div class="flex flex-col justify-between cursor-pointer " style="width:100%;height:1.15rem" aria-expanded="false" aria-label="Toggle menu"><div class="h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out opacity-100"></div><div class="relative h-0.5 w-full"><div class="absolute top-0 left-0 h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out rotate-0"></div><div class="absolute top-0 left-0 h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out rotate-0"></div></div><div class="h-[2px] w-full rounded-sm bg-text-primary transition-all duration-300 ease-in-out opacity-100"></div></div></div></div></header><div class="text-accent h-15.75 w-full pt-2.5 text-center font-serif text-[10px] italic opacity-60">人活着就是为了卡卡西</div><div class="mx-auto w-170 px-5 py-15 max-xl:w-[calc(100%-480px)] max-xl:max-w-170 max-lg:w-auto max-lg:max-w-170 max-sm:w-full max-sm:py-12"><article><h1 class="mt-0 mb-0 text-center">关于 typescript 泛型中返回值类型约束的问题</h1><div class="mt-4 text-center text-sm font-semibold text-[#989898]">2023年11月11日</div><div class="mt-4 mb-6 pb-6 text-center text-sm font-semibold"><div class="inline-block max-w-1/2"><span class="pr-2 text-sm leading-6"><a class="text-text-primary hover:text-accent transition-colors" href="/categories/学习" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder mr-0.5 ml-2 inline pb-0.5" aria-hidden="true"><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"></path></svg>学习</a></span><span class="text-sm leading-none"><a class="bg-tag-bg text-text-secondary hover:bg-accent-hover m-px inline-block rounded-full px-2 py-1 transition-colors" href="/tags/typescript" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="0.875em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-0.5 inline" aria-hidden="true"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"></path><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"></circle></svg>typescript</a></span></div></div><section><div class="text-right text-sm opacity-50"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye mr-1 mb-0.5" aria-hidden="true"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"></path><circle cx="12" cy="12" r="3"></circle></svg><span class="waline-pageview-count mr-1" data-path="/posts/2023-11-11-typescript-generatic-type-proble-ts2322"></span>阅读<span class="hover:text-accent cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square mr-1 mb-0.5 ml-4" aria-hidden="true"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"></path></svg><span class="waline-comment-count mr-1" data-path="/posts/2023-11-11-typescript-generatic-type-proble-ts2322"></span>评论</span></div></section><div class="markdown-wrapper"></div><section><div class="mt-16 text-right text-sm opacity-50">更新于 <!-- -->2023-11-11</div></section><div class="my-16 flex flex-wrap items-center justify-between"><div class="flex-[1_1_auto]"><a class="group inline-flex items-center justify-start py-1" href="/posts/thoughts-about-wubi-im" data-discover="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span class="relative mx-2">大概是关于五笔打字更慢的一点碎碎念？<span class="bg-accent-hover absolute bottom-0 left-0 h-0.5 w-0 rounded transition-[width] duration-1000 ease-[cubic-bezier(0.34,0.04,0.03,1.4)] group-hover:w-full"></span></span></a></div><div class="flex-[1_1_auto]"><a class="group inline-flex w-full items-center justify-end py-1" href="/posts/2023-10-09-the-little-prince-review" data-discover="true"><span class="relative mx-2">重读《小王子》<span class="bg-accent-hover absolute bottom-0 left-0 h-0.5 w-0 rounded transition-[width] duration-1000 ease-[cubic-bezier(0.34,0.04,0.03,1.4)] group-hover:w-full"></span></span><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right" aria-hidden="true"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg></a></div></div></article><!--$--><div id="waline">Waline</div><!--/$--></div><aside class="/* Desktop positioning */ fixed left-[78%] z-5 w-72 max-w-72 overflow-auto transition-[top] duration-300 xl:animate-[fadeInRight_0.3s_ease] top-32 max-h-[calc(100vh-8rem)] /* Tablet: narrower */ /* Mobile: drawer from bottom/right */ max-lg:bg-bg max-lg:shadow-float-menu max-lg:border-ui-line-gray-3 max-xl:left-[76%] max-xl:w-60 max-lg:top-auto max-lg:right-2 max-lg:bottom-34 max-lg:left-auto max-lg:max-h-[calc(100vh-8rem-9rem)] max-lg:w-75 max-lg:rounded-lg max-lg:border max-lg:transition-all max-lg:duration-300 max-lg:pointer-events-none max-lg:translate-x-full max-lg:opacity-0 /* Small mobile: full width drawer from bottom */ max-sm:right-[2%] max-sm:bottom-0 max-sm:max-h-[60vh] max-sm:w-[96%] max-sm:max-w-none max-sm:translate-x-0 max-sm:translate-y-full "><div class="max-lg:bg-bg sticky top-0 z-9 mb-2 pt-4 pr-4 pb-2 pl-8 text-xl font-bold max-lg:pr-4 max-lg:pl-8">目录<button class="text-text-gray-2 hover:text-accent float-right hidden cursor-pointer text-[1rem] max-lg:block invisible "><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x" aria-hidden="true"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button></div><nav class="pr-4 pb-4 pl-8 max-lg:px-6 max-lg:pr-4 max-lg:pl-8"><span class="text-sm opacity-60">这是一篇没有目录的文章。</span></nav></aside><button class="text-text-gray-2 bg-tag-bg hover:text-text-primary active:bg-accent-hover active:text-text-primary fixed right-4 bottom-8 z-5 h-10 w-10 cursor-pointer rounded-[0.625rem] border-0 text-xl backdrop-blur-sm transition-colors max-lg:block hidden "><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" aria-hidden="true"><path d="M4 5h16"></path><path d="M4 12h16"></path><path d="M4 19h16"></path></svg></button><footer class="pt-6 pb-2.5 text-center text-[10px] text-text-secondary "><nav><a href="https://github.com/sansui233" class="inline-block mx-2 hover:text-accent-hover transition-colors duration-200" target="_blank" rel="noopener noreferrer" aria-label="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github w-6 h-6" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><a href="mailto:sansuilnm@gmail.com" class="inline-block mx-2 hover:text-accent-hover transition-colors duration-200" aria-label="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail w-6 h-6" aria-hidden="true"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path><rect x="2" y="4" width="20" height="16" rx="2"></rect></svg></a><a href="/rss" class="inline-block mx-2 hover:text-accent-hover transition-colors duration-200" aria-label="RSS"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss w-6 h-6" aria-hidden="true"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></nav><div class="my-6 mx-auto tracking-[0.2px]">© Sansui 2026<!-- --> <br/> <!-- -->All rights reserved</div></footer><script>((storageKey2, restoreKey) => {
    if (!window.history.state || !window.history.state.key) {
      let key = Math.random().toString(32).slice(2);
      window.history.replaceState({ key }, "");
    }
    try {
      let positions = JSON.parse(sessionStorage.getItem(storageKey2) || "{}");
      let storedY = positions[restoreKey || window.history.state.key];
      if (typeof storedY === "number") {
        window.scrollTo(0, storedY);
      }
    } catch (error) {
      console.error(error);
      sessionStorage.removeItem(storageKey2);
    }
  })("react-router-scroll-positions", null)</script><script>window.__reactRouterContext = {"basename":"/","future":{"unstable_optimizeDeps":false,"unstable_subResourceIntegrity":false,"v8_middleware":false,"v8_splitRouteModules":false,"v8_viteEnvironmentApi":false},"routeDiscovery":{"mode":"initial"},"ssr":false,"isSpaMode":false};window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());</script><script type="module" async="">import "/assets/manifest-4c8363cb.js";
import * as route0 from "/assets/root-C0ep9fuI.js";
import * as route1 from "/assets/RootLayout-CHttVE2X.js";
import * as route2 from "/assets/posts._slug-DRWishpF.js";
  
  window.__reactRouterRouteModules = {"root":route0,"components/RootLayout":route1,"routes/posts.$slug":route2};

import("/assets/entry.client-DkTTQJrl.js");</script><!--$?--><template id="B:1"></template><!--/$--><script id="_R_">requestAnimationFrame(function(){$RT=performance.now()});</script><div hidden id="S:0"><div class="bg-bg border-ui-line-gray-2 fixed top-13.75 right-0 z-11 m-[0_10px] w-96 overflow-hidden rounded-xl border shadow-[0_0_12px_var(--shadow-bg)] transition-all duration-300 ease-out max-[580px]:max-h-[50%] max-[580px]:w-[96%] pointer-events-none invisible -translate-y-2.5 opacity-0 "><div class="bg-bg sticky top-0 p-4 pb-0"><input type="text" placeholder="搜索你感兴趣的内容，以空格分词" class="bg-bg text-text-primary w-full rounded-none border-none focus:outline-none focus-visible:outline-none"/></div><div class="max-h-[60vh] overflow-y-auto px-4 py-2"><div class="text-sm opacity-50"><div class="text-text-gray overflow-hidden text-sm whitespace-nowrap">输入关键词开始搜索</div></div></div></div></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><div hidden id="S:1"><script>window.__reactRouterContext.streamController.enqueue("[{\"_1\":2,\"_50\":-5,\"_51\":-5},\"loaderData\",{\"_3\":4},\"routes/posts.$slug\",{\"_5\":6,\"_42\":43,\"_46\":47},\"post\",{\"_7\":8,\"_9\":10,\"_11\":12,\"_13\":-5,\"_14\":15,\"_16\":17,\"_22\":23,\"_24\":25,\"_26\":27,\"_28\":29,\"_30\":31,\"_33\":34,\"_35\":36,\"_40\":41},\"title\",\"关于 typescript 泛型中返回值类型约束的问题\",\"slug\",\"2023-11-11-typescript-generatic-type-proble-ts2322\",\"date\",\"2023-11-11T14:26:09.000Z\",\"description\",\"draft\",false,\"metadata\",{\"_18\":19,\"_20\":21},\"readingTime\",4,\"wordCount\",935.6800000000001,\"excerpt\",\"最近遇到这么一个需求。\\n\\n定义一个函数接口，要求其返回值类型是 type A 的任意超集。\\n\\n于是我按直觉写下了：\\ntype A  = { a: string }\\ntype FuncA  = \u003cT extends A\u003e() =\u003e T\\nconst f: FuncA = () =\u003e {\\n  return { a: \\\"ok\\\" } \\n}\\n\\n人来看非常简单知道是什么意思，就是返回值包含所有 a 的属性，其他属性全是可有可无的。\\n这段代码扔给 GPT，它也看不出什么毛病。但事实上，在 return 时报了一个错：\\nType '\",\"content_html\",\"\u003cp\u003e最近遇到这么一个需求。\u003c/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003e定义一个函数接口，要求其返回值类型是 type A 的任意超集。\u003c/p\u003e\\n\u003c/blockquote\u003e\\n\u003cp\u003e于是我按直觉写下了：\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-typescript\\\"\u003etype A  = { a: string }\\ntype FuncA  = \u0026#x3C;T extends A\u003e() =\u003e T\\nconst f: FuncA = () =\u003e {\\n  return { a: \\\"ok\\\" } \\n}\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e人来看非常简单知道是什么意思，就是返回值包含所有 a 的属性，其他属性全是可有可无的。\u003c/p\u003e\\n\u003cp\u003e这段代码扔给 GPT，它也看不出什么毛病。但事实上，在 return 时报了一个错：\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-text\\\"\u003eType '() =\u003e A' is not assignable to type 'FuncA'.\\n  Type 'A' is not assignable to type 'T'.\\n    'A' is assignable to the constraint of type 'T', but 'T' could be instantiated with a different subtype of constraint 'A'.ts(2322)\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e这个报错非常的不 helpful。因为平时， typescript 可以根据返回值推测出具体函数标注。比如\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-ts\\\"\u003efunction foo(){\\n  return \\\"1\\\"\\n} // 自动推断出函数的具体签名为 () =\u003e string\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e那为什么上面的报错例子，不能做这样的推断呢？\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-ts\\\"\u003etype A  = { a: string }\\ntype FuncA  = \u0026#x3C;T extends A\u003e() =\u003e T\\nconst f: FuncA = () =\u003e {\\n  return { a: \\\"ok\\\" } \\n} \\n/* 推断出具体的签名类似于\\n() =\u003e {\\n  a: string;\\n  [name: string]: any\\n}\\n*/\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e也就是说，a 是必选属性，其他属性全是 optional。\u003c/p\u003e\\n\u003cp\u003e（先不讨论 Object 的 key 可以是 Symbol，只是为了看起来好理解，我只写了 string。要写全这里又要多写一个类型推断。）\u003c/p\u003e\\n\u003cp\u003e当然这里又引发了另一个问题：你为什么不直接把 type A 定义附加任意可选属性？\u003c/p\u003e\\n\u003cp\u003e好问题，这是一个正常的解决 TS2322 问题的思路。但是我就是想知道为什么泛型推断不能直接做这个……\u003c/p\u003e\\n\u003cp\u003e我查了很多资料，没有人完美解释这个问题。但有一个相似的问题：如何让参数和返回值持有相同的泛型类型？\u003c/p\u003e\\n\u003cp\u003e在 typescript 的 \u003ca href=\\\"https://github.com/microsoft/TypeScript/issues/50027\\\"\u003egithub issue\u003c/a\u003e 里有详细的案例说明，务必看看，很好懂，说是故意这么设计的。这里我将理由简短概括如下：\u003c/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003e如果 f 是上有一个额外的属性 prop，编译器如果推导出了返回值类型成 typeof f。之后你调用 f.prop，静态编译不会报错，但实际上有一个 runtime error，因为你的真实的返回值只是一个 \u003ccode\u003e()=\u003e{}\u003c/code\u003e ，没有prop 属性。\u003c/p\u003e\\n\u003c/blockquote\u003e\\n\u003cp\u003e但个人觉得这里静态编译应该报错，并不是一个 runtime 错误。前面说了，typescript 可以对返回值进行静态的类型的检查。以上面 issue 为例，理想的报错设计是长这样：\u003c/p\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-ts\\\"\u003etype A = () =\u003e void;\\ntype B = () =\u003e void;\\n\\n// 类型签名为 \u0026#x3C;T extends A | B\u003e(value: T) =\u003e T 的实现\\nfunction f1\u0026#x3C;T extends A | B\u003e(value: T): T {\\n  return () =\u003e {};  // 推断出 T 此时是 typeof ()=\u003e{}，也就是 ()=\u003e{}\\n}\\n\\nlet f: any= ()=\u003e{}\\nf.prop = \\\"haha\\\"\\n\\nf1(f) // 这里传参报错，因为 typeof f 和 typeof ()=\u003e{} 不一致。本质上就是 ts2322 描述的问题，但不应该在上面报错\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e当然上面的例子返回值类型已经定了是 \u003ccode\u003etypeof ()=\u003e{}\u003c/code\u003e，返回值再标注 T 显得十分多此一举。但是 f1 对只是对这个函数签名的一种实现。完全可以实现对这个函数签名有不同的实现，返回不同的 subtype。\u003c/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003e什么是 subtype？T extends A，T 就是 A 的 subtype\u003c/p\u003e\\n\u003c/blockquote\u003e\\n\u003cp\u003e这又引发了另一个问题：这和函数重载有什么区别？\u003c/p\u003e\\n\u003cp\u003e当然有区别啊，最大的区别就是我能定义一个统一的函数接口，只要返回值满足最基本的约束 \u003ccode\u003eA\u003c/code\u003e。但可以是返回不同的 subtype，实现也分开写到不同的文件里，类似于 oop 语言中返回所有某基类的派生类。这才是完全体。\u003c/p\u003e\\n\u003cp\u003e但现在的 typescript 完全做不到这一点，返回值只能是一个非常具体的 type，要么就抛出一个毫无说服力的 ts2322 错误。\u003c/p\u003e\\n\u003cp\u003e如果要解决开头的问题，大概是以下三个思路：\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e定义 A 时，把所有可能要用到的属性都写到可选属性里，或直接 \u003ccode\u003e[name: string]: any\u003c/code\u003e。\u003c/li\u003e\\n\u003cli\u003e考虑业务场景，其他未知属性不留下会影响到什么吗。99% 的场景是没有必要的，也就是说这个需求就是没意义的。剩下的 1% 我没有遇到/想到。\u003c/li\u003e\\n\u003cli\u003e根据输入参数的 T 写一个类型推导，手动将返回的类型设置为 a 的具体扩展类型。类似这样\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cpre\u003e\u003ccode class=\\\"language-typescript\\\"\u003etype Extend\u0026#x3C;T extends object\u003e = {\\n  [name: string]: any\\n} \u0026#x26; {\\n  [K in keyof T]: T[K]\\n}\\n\\ntype A  = {a: string}\\ntype FuncA  = () =\u003e Extend\u0026#x3C;A\u003e\\nconst f: FuncA = () =\u003e {\\n  return { a: \\\"ok\\\", b:\\\"extra\\\"} \\n} \\nf().a // a is string\\nf().b // b is any\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e总之，在目前的 typescript 中，\u003cstrong\u003e返回值类型不能是泛型\u003c/strong\u003e。\u003c/p\u003e\\n\u003cp\u003e当然这样也失去了扩展的类型检查，等于是用了函数的签名来检查的，和返回值的类型一点关系也没有。\u003c/p\u003e\\n\u003cp\u003e现在 typescript 的静态检查器其实已经做了一些运行时的功能，比如条件语句判断以排除属性。但是，这些像运行时一样的检查只在静态类型不明确时才起作用。就这个 if，我已经遇到了好几次无法判断的 bug ，清空缓存并重启才恢复。\u003c/p\u003e\\n\u003cp\u003e说回第二点，既然你允许传了任意值，也就说明在你这个库中，你也不知道其他附加值具体是拿来干什么的，大多无非遍历一下再过滤一下。如果是静态类型检查器来遍历，诶诶扩展属性怎么全是 any。最终还得用 JS 的运行时来做这个事情……所以有拿来做什么的话早就在 A 里增加 optional 属性了。这也是为什么说 99% 的场景这个需求其实不存在。\u003c/p\u003e\\n\u003cp\u003e还有一个更重要的原因，那就是，ts 的类型体操，实在太他妈难写了。\u003c/p\u003e\\n\u003chr\u003e\\n\u003cp\u003e可能没用的参考：\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e\u003ca href=\\\"https://stackoverflow.com/questions/56505560/how-to-fix-ts2322-could-be-instantiated-with-a-different-subtype-of-constraint\\\"\u003etypescript - How to fix TS2322: \\\"could be instantiated with a different subtype of constraint 'object'\\\"? - Stack Overflow\u003c/a\u003e\u003c/li\u003e\\n\u003cli\u003e\u003ca href=\\\"https://github.com/microsoft/TypeScript/issues/50027\\\"\u003eCould be instantiated with a different subtype of constraint · Issue #50027 · microsoft/TypeScript\u003c/a\u003e\u003c/li\u003e\\n\u003c/ul\u003e\",\"content_jsx\",\"const{Fragment:n,jsx:s,jsxs:e}=arguments[0];function _createMdxContent(l){const a={a:\\\"a\\\",blockquote:\\\"blockquote\\\",code:\\\"code\\\",hr:\\\"hr\\\",li:\\\"li\\\",p:\\\"p\\\",pre:\\\"pre\\\",span:\\\"span\\\",strong:\\\"strong\\\",ul:\\\"ul\\\",...l.components};return e(n,{children:[s(a.p,{children:\\\"最近遇到这么一个需求。\\\"}),\\\"\\\\n\\\",e(a.blockquote,{children:[\\\"\\\\n\\\",s(a.p,{children:\\\"定义一个函数接口，要求其返回值类型是 type A 的任意超集。\\\"}),\\\"\\\\n\\\"]}),\\\"\\\\n\\\",s(a.p,{children:\\\"于是我按直觉写下了：\\\"}),\\\"\\\\n\\\",s(a.pre,{children:e(a.code,{className:\\\"hljs language-typescript\\\",children:[s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" A  = { \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"string\\\"}),\\\" }\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\"  = \u003cT \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"extends\\\"}),\\\" A\u003e\\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" T\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"const\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"f\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\" = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" {\\\\n  \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"return\\\"}),\\\" { \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"ok\\\"'}),\\\" } \\\\n}\\\\n\\\"]})}),\\\"\\\\n\\\",s(a.p,{children:\\\"人来看非常简单知道是什么意思，就是返回值包含所有 a 的属性，其他属性全是可有可无的。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"这段代码扔给 GPT，它也看不出什么毛病。但事实上，在 return 时报了一个错：\\\"}),\\\"\\\\n\\\",s(a.pre,{children:s(a.code,{className:\\\"hljs language-text\\\",children:\\\"Type '() =\u003e A' is not assignable to type 'FuncA'.\\\\n  Type 'A' is not assignable to type 'T'.\\\\n    'A' is assignable to the constraint of type 'T', but 'T' could be instantiated with a different subtype of constraint 'A'.ts(2322)\\\\n\\\"})}),\\\"\\\\n\\\",s(a.p,{children:\\\"这个报错非常的不 helpful。因为平时， typescript 可以根据返回值推测出具体函数标注。比如\\\"}),\\\"\\\\n\\\",s(a.pre,{children:e(a.code,{className:\\\"hljs language-ts\\\",children:[s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"function\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title function_\\\",children:\\\"foo\\\"}),\\\"(\\\",s(a.span,{className:\\\"hljs-params\\\"}),\\\"){\\\\n  \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"return\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"1\\\"'}),\\\"\\\\n} \\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// 自动推断出函数的具体签名为 () =\u003e string\\\"}),\\\"\\\\n\\\"]})}),\\\"\\\\n\\\",s(a.p,{children:\\\"那为什么上面的报错例子，不能做这样的推断呢？\\\"}),\\\"\\\\n\\\",s(a.pre,{children:e(a.code,{className:\\\"hljs language-ts\\\",children:[s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" A  = { \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"string\\\"}),\\\" }\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\"  = \u003cT \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"extends\\\"}),\\\" A\u003e\\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" T\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"const\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"f\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\" = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" {\\\\n  \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"return\\\"}),\\\" { \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"ok\\\"'}),\\\" } \\\\n} \\\\n\\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"/* 推断出具体的签名类似于\\\\n() =\u003e {\\\\n  a: string;\\\\n  [name: string]: any\\\\n}\\\\n*/\\\"}),\\\"\\\\n\\\"]})}),\\\"\\\\n\\\",s(a.p,{children:\\\"也就是说，a 是必选属性，其他属性全是 optional。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"（先不讨论 Object 的 key 可以是 Symbol，只是为了看起来好理解，我只写了 string。要写全这里又要多写一个类型推断。）\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"当然这里又引发了另一个问题：你为什么不直接把 type A 定义附加任意可选属性？\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"好问题，这是一个正常的解决 TS2322 问题的思路。但是我就是想知道为什么泛型推断不能直接做这个……\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"我查了很多资料，没有人完美解释这个问题。但有一个相似的问题：如何让参数和返回值持有相同的泛型类型？\\\"}),\\\"\\\\n\\\",e(a.p,{children:[\\\"在 typescript 的 \\\",s(a.a,{href:\\\"https://github.com/microsoft/TypeScript/issues/50027\\\",children:\\\"github issue\\\"}),\\\" 里有详细的案例说明，务必看看，很好懂，说是故意这么设计的。这里我将理由简短概括如下：\\\"]}),\\\"\\\\n\\\",e(a.blockquote,{children:[\\\"\\\\n\\\",e(a.p,{children:[\\\"如果 f 是上有一个额外的属性 prop，编译器如果推导出了返回值类型成 typeof f。之后你调用 f.prop，静态编译不会报错，但实际上有一个 runtime error，因为你的真实的返回值只是一个 \\\",s(a.code,{children:\\\"()=\u003e{}\\\"}),\\\" ，没有prop 属性。\\\"]}),\\\"\\\\n\\\"]}),\\\"\\\\n\\\",s(a.p,{children:\\\"但个人觉得这里静态编译应该报错，并不是一个 runtime 错误。前面说了，typescript 可以对返回值进行静态的类型的检查。以上面 issue 为例，理想的报错设计是长这样：\\\"}),\\\"\\\\n\\\",s(a.pre,{children:e(a.code,{className:\\\"hljs language-ts\\\",children:[s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" A = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"void\\\"}),\\\";\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" B = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"void\\\"}),\\\";\\\\n\\\\n\\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// 类型签名为 \u003cT extends A | B\u003e(value: T) =\u003e T 的实现\\\"}),\\\"\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"function\\\"}),\\\" f1\u003cT \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"extends\\\"}),\\\" A | B\u003e(\\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"value\\\"}),\\\": T): T {\\\\n  \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"return\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" {};  \\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// 推断出 T 此时是 typeof ()=\u003e{}，也就是 ()=\u003e{}\\\"}),\\\"\\\\n}\\\\n\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"let\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"f\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"any\\\"}),\\\"= \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"()=\u003e\\\"}),\\\"{}\\\\nf.\\\",s(a.span,{className:\\\"hljs-property\\\",children:\\\"prop\\\"}),\\\" = \\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"haha\\\"'}),\\\"\\\\n\\\\n\\\",s(a.span,{className:\\\"hljs-title function_\\\",children:\\\"f1\\\"}),\\\"(f) \\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// 这里传参报错，因为 typeof f 和 typeof ()=\u003e{} 不一致。本质上就是 ts2322 描述的问题，但不应该在上面报错\\\"}),\\\"\\\\n\\\"]})}),\\\"\\\\n\\\",e(a.p,{children:[\\\"当然上面的例子返回值类型已经定了是 \\\",s(a.code,{children:\\\"typeof ()=\u003e{}\\\"}),\\\"，返回值再标注 T 显得十分多此一举。但是 f1 对只是对这个函数签名的一种实现。完全可以实现对这个函数签名有不同的实现，返回不同的 subtype。\\\"]}),\\\"\\\\n\\\",e(a.blockquote,{children:[\\\"\\\\n\\\",s(a.p,{children:\\\"什么是 subtype？T extends A，T 就是 A 的 subtype\\\"}),\\\"\\\\n\\\"]}),\\\"\\\\n\\\",s(a.p,{children:\\\"这又引发了另一个问题：这和函数重载有什么区别？\\\"}),\\\"\\\\n\\\",e(a.p,{children:[\\\"当然有区别啊，最大的区别就是我能定义一个统一的函数接口，只要返回值满足最基本的约束 \\\",s(a.code,{children:\\\"A\\\"}),\\\"。但可以是返回不同的 subtype，实现也分开写到不同的文件里，类似于 oop 语言中返回所有某基类的派生类。这才是完全体。\\\"]}),\\\"\\\\n\\\",s(a.p,{children:\\\"但现在的 typescript 完全做不到这一点，返回值只能是一个非常具体的 type，要么就抛出一个毫无说服力的 ts2322 错误。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"如果要解决开头的问题，大概是以下三个思路：\\\"}),\\\"\\\\n\\\",e(a.ul,{children:[\\\"\\\\n\\\",e(a.li,{children:[\\\"定义 A 时，把所有可能要用到的属性都写到可选属性里，或直接 \\\",s(a.code,{children:\\\"[name: string]: any\\\"}),\\\"。\\\"]}),\\\"\\\\n\\\",s(a.li,{children:\\\"考虑业务场景，其他未知属性不留下会影响到什么吗。99% 的场景是没有必要的，也就是说这个需求就是没意义的。剩下的 1% 我没有遇到/想到。\\\"}),\\\"\\\\n\\\",s(a.li,{children:\\\"根据输入参数的 T 写一个类型推导，手动将返回的类型设置为 a 的具体扩展类型。类似这样\\\"}),\\\"\\\\n\\\"]}),\\\"\\\\n\\\",s(a.pre,{children:e(a.code,{className:\\\"hljs language-typescript\\\",children:[s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"Extend\\\"}),\\\"\u003cT \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"extends\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"object\\\"}),\\\"\u003e = {\\\\n  [\\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"name\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"string\\\"}),\\\"]: \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"any\\\"}),\\\"\\\\n} \u0026 {\\\\n  [K \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"in\\\"}),\\\" keyof T]: T[K]\\\\n}\\\\n\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" A  = {\\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-built_in\\\",children:\\\"string\\\"}),\\\"}\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"type\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\"  = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"Extend\\\"}),\\\"\u003cA\u003e\\\\n\\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"const\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"f\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-title class_\\\",children:\\\"FuncA\\\"}),\\\" = \\\",s(a.span,{className:\\\"hljs-function\\\",children:\\\"() =\u003e\\\"}),\\\" {\\\\n  \\\",s(a.span,{className:\\\"hljs-keyword\\\",children:\\\"return\\\"}),\\\" { \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"a\\\"}),\\\": \\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"ok\\\"'}),\\\", \\\",s(a.span,{className:\\\"hljs-attr\\\",children:\\\"b\\\"}),\\\":\\\",s(a.span,{className:\\\"hljs-string\\\",children:'\\\"extra\\\"'}),\\\"} \\\\n} \\\\n\\\",s(a.span,{className:\\\"hljs-title function_\\\",children:\\\"f\\\"}),\\\"().\\\",s(a.span,{className:\\\"hljs-property\\\",children:\\\"a\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// a is string\\\"}),\\\"\\\\n\\\",s(a.span,{className:\\\"hljs-title function_\\\",children:\\\"f\\\"}),\\\"().\\\",s(a.span,{className:\\\"hljs-property\\\",children:\\\"b\\\"}),\\\" \\\",s(a.span,{className:\\\"hljs-comment\\\",children:\\\"// b is any\\\"}),\\\"\\\\n\\\"]})}),\\\"\\\\n\\\",e(a.p,{children:[\\\"总之，在目前的 typescript 中，\\\",s(a.strong,{children:\\\"返回值类型不能是泛型\\\"}),\\\"。\\\"]}),\\\"\\\\n\\\",s(a.p,{children:\\\"当然这样也失去了扩展的类型检查，等于是用了函数的签名来检查的，和返回值的类型一点关系也没有。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"现在 typescript 的静态检查器其实已经做了一些运行时的功能，比如条件语句判断以排除属性。但是，这些像运行时一样的检查只在静态类型不明确时才起作用。就这个 if，我已经遇到了好几次无法判断的 bug ，清空缓存并重启才恢复。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"说回第二点，既然你允许传了任意值，也就说明在你这个库中，你也不知道其他附加值具体是拿来干什么的，大多无非遍历一下再过滤一下。如果是静态类型检查器来遍历，诶诶扩展属性怎么全是 any。最终还得用 JS 的运行时来做这个事情……所以有拿来做什么的话早就在 A 里增加 optional 属性了。这也是为什么说 99% 的场景这个需求其实不存在。\\\"}),\\\"\\\\n\\\",s(a.p,{children:\\\"还有一个更重要的原因，那就是，ts 的类型体操，实在太他妈难写了。\\\"}),\\\"\\\\n\\\",s(a.hr,{}),\\\"\\\\n\\\",s(a.p,{children:\\\"可能没用的参考：\\\"}),\\\"\\\\n\\\",e(a.ul,{children:[\\\"\\\\n\\\",s(a.li,{children:s(a.a,{href:\\\"https://stackoverflow.com/questions/56505560/how-to-fix-ts2322-could-be-instantiated-with-a-different-subtype-of-constraint\\\",children:\\\"typescript - How to fix TS2322: \\\\\\\"could be instantiated with a different subtype of constraint 'object'\\\\\\\"? - Stack Overflow\\\"})}),\\\"\\\\n\\\",s(a.li,{children:s(a.a,{href:\\\"https://github.com/microsoft/TypeScript/issues/50027\\\",children:\\\"Could be instantiated with a different subtype of constraint · Issue #50027 · microsoft/TypeScript\\\"})}),\\\"\\\\n\\\"]})]})}return{default:function(n={}){const{wrapper:e}=n.components||{};return e?s(e,{...n,children:s(_createMdxContent,{...n})}):_createMdxContent(n)}};\",\"toc\",[],\"tags\",[32],\"typescript\",\"categories\",\"学习\",\"keywords\",[32,37,38,39],\"ts\",\"generic type\",\"ts2322，泛型约束\",\"permalink\",\"/posts/2023-11-11-typescript-generatic-type-proble-ts2322\",\"prevPost\",{\"_7\":44,\"_9\":45},\"大概是关于五笔打字更慢的一点碎碎念？\",\"thoughts-about-wubi-im\",\"nextPost\",{\"_7\":48,\"_9\":49},\"重读《小王子》\",\"2023-10-09-the-little-prince-review\",\"actionData\",\"errors\"]\n");</script><!--$?--><template id="B:2"></template><!--/$--></div><script>$RC("B:1","S:1")</script><div hidden id="S:2"><script>window.__reactRouterContext.streamController.close();</script></div><script>$RC("B:2","S:2")</script></body></html>