[{"_1":2},"routes/posts.$slug",{"_3":4},"data",{"_5":6,"_68":69,"_71":72},"post",{"_7":8,"_9":10,"_11":12,"_13":-5,"_14":15,"_16":17,"_22":23,"_24":25,"_26":27,"_28":29,"_56":57,"_59":60,"_61":62,"_66":67},"title","Windows 命令行相关配置","slug","2023-11-29-windows-shell-configuration","date","2023-11-28T20:07:06.000Z","description","draft",false,"metadata",{"_18":19,"_20":21},"readingTime",3,"wordCount",727.8800000000001,"excerpt","常用 shell\n一直以来 windows 的命令行方案都很多，个人感觉都有不太好用的点，怎么配置也是仁者见仁智者见智的一个事情。先总结一下常用shell 方案\n\npowershell 官方shell，各种工具库支持最全，缺点自带的命令太长，以至于完全没有日常使用的想法。\nmsys2 windows 上的类 unix 环境，基于现代 Cygwin (POSIX兼容层) 和 MinGW-w64（工具包）。确实像 unix，一般命令可以无缝迁移。缺点是兼容性，需要手动配置很多东西，比如是否继承 windows 环境变量","content_html","<h2>常用 shell</h2>\n<p>一直以来 windows 的命令行方案都很多，个人感觉都有不太好用的点，怎么配置也是仁者见仁智者见智的一个事情。先总结一下常用shell 方案</p>\n<ul>\n<li><code>powershell</code> 官方shell，各种工具库支持最全，缺点自带的命令太长，以至于完全没有日常使用的想法。</li>\n<li><code>msys2</code> windows 上的类 unix 环境，基于现代 Cygwin (POSIX兼容层) 和 MinGW-w64（工具包）。确实像 unix，一般命令可以无缝迁移。缺点是兼容性，需要手动配置很多东西，比如是否继承 windows 环境变量，不继承的话不想维护两份环境，继承了又容易冲突。</li>\n<li><code>git bash</code> msys2 阉割版，无包管理，多了 git。</li>\n<li><code>wsl</code> 完全的 Linux 子系统，但太占内存。</li>\n</ul>\n<h2>方案选择</h2>\n<p>我需求</p>\n<ul>\n<li>常用命令必须是类 unix 命令</li>\n<li>有包管理器，各类命令行工具配置友好且兼容性不错。</li>\n<li>不要太占内存</li>\n</ul>\n<p>结果发现这就是经典的三圈相交，没有任何一个常用方案能满足以上要求。</p>\n<p>最后，我决定用 powershell。除了第一条外都满足。后面两条属于难以解决的硬伤，而第一条可以编写脚本，将常用的命令模拟。</p>\n<h3>powershell 配置流程</h3>\n<p>包含工具包、终端美化。</p>\n<ol>\n<li>Install the latest Powershell Core</li>\n<li>Install <a href=\"https://gitforwindows.org/\">git-bash</a> for basic bash and git tools</li>\n<li>Install <a href=\"https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701?hl=zh-cn&#x26;gl=cn&#x26;rtc=1\">Windows Terminal</a> and open Powershell</li>\n<li>Install <a href=\"https://github.com/PowerShell/PSReadLine\">PSReadLine</a></li>\n<li>Install <a href=\"https://starship.rs/\">starship</a> with <strong>Winget</strong>, Don't use scoop(too slow).</li>\n<li>Install <a href=\"https://github.com/gerardog/gsudo\">gsudo</a> for softlink</li>\n<li>Install <a href=\"https://eza.rocks/\">eza</a> for listing</li>\n<li>open <code>$PROFILE</code> in powershell, append the contents of <a href=\"https://gist.github.com/Sansui233/0451b8f7c354d600c4efa74fc284d39c#file-microsoft-powershell_profile-ps1\"><strong>Microsoft.PowerShell_profile.ps1</strong></a></li>\n</ol>\n<p>大致介绍一下用途。</p>\n<ul>\n<li>git-bash，一系列类 unix 工具，git 一类的</li>\n<li>Windows Terminal，微软的终端。我拒绝终端用 electron 去套的……</li>\n<li>PSReadLine，改变一系列 powershell 的行为。比如复制粘贴的快捷键。可惜在 vscode 里会没用，只能右键粘贴。</li>\n<li>oh-my-posh，美化。需要用 Winget 或者自己 Setup 安装。不要让 Scoop 装，找环境变量这一步能把启动速度拖慢1s。这个可以用 starship 或者 posh-git 替代。不过都挺慢的。</li>\n<li>gsudo，提权，类似 unix 的 sudo。可能运行时会被杀软报毒，需要加入信任区。</li>\n<li>eza，2024年了，终于有了一个像样的 ls 替代……</li>\n</ul>\n<p>powershell 的用户配置文件输入 <code>$PROFILE</code> 就能找到。</p>\n<p>我的配置文件上传到了 <a href=\"https://gist.github.com/Sansui233/0451b8f7c354d600c4efa74fc284d39c#file-microsoft-powershell_profile-ps1\"><strong>Microsoft.PowerShell_profile.ps1</strong></a>。需要挂代理打开。配置文件包含 <code>ls</code> <code>ln</code> <code>open</code> <code>grep</code> <code>which</code> 等命令模拟。powershell 的缩写默认支持了 <code>mv</code> <code>cat</code> <code>rm</code> 等命令，配合起来日常基本够用。</p>\n<h2>终端代理</h2>\n<p>我在配置文件中设置了<code>proxy</code>和<code>unproxy</code>函数，以快速设置与取消终端的代理连接。自己改下端口就能用。因为我自己习惯上不开系统代理，都是软件内的 http 连接。</p>\n<pre><code class=\"language-powershell\"># Proxy Togglers\nfunction proxy {\n\t$portInUse = netstat -ano | findstr \"LISTENING\" | findstr \"7890\"\n\t$portInUse2 = netstat -ano | findstr \"LISTENING\" | findstr \"10808\"\n\tif ($portInUse -ne $null) {\n\t\t$env:HTTP_PROXY = \"socks5://127.0.0.1:7890\"\n\t\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:7890\"\n\t\tWrite-Host \"Proxy set to socks port 7890\"\n\t} elseif ($portInUse2 -ne $null) {\n\t\t$env:HTTP_PROXY = \"socks5://127.0.0.1:10808\"\n\t\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:10808\"\n\t\tWrite-Host \"Proxy set to socks port 10808\"\n\t} else {\n\t\t$env:HTTP_PROXY = \"socks5://127.0.0.1:1080\"\n\t\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:1080\"\n\t\tWrite-Host \"Proxy set to socks port \"\n\t}\n}\nfunction unproxy {\n\t$env:HTTP_PROXY = \"\"\n\t$env:HTTPS_PROXY = \"\"\n}\n</code></pre>\n<h2>其他常用工具</h2>\n<ul>\n<li>\n<p>winget：自带的包管理器，命令行工具都是这个装的。部分用的 scoop，非常少。还有的直接用的官网 setup。</p>\n</li>\n<li>\n<p>nvim：命令行编辑器，vim 的替代品。我用的是发行版 AstroNvim。之前也有自己折腾插件，太懒得维护了，算了。</p>\n</li>\n<li>\n<p>nodejs：JS 环境，nvim 的插件要用，开发也要用</p>\n</li>\n<li>\n<p>zoxide：快速跳转目录。最有用的功能没有之一。类似 unix 的 autojump</p>\n</li>\n<li>\n<p>Terminal-Icons：ls 命令加 icon，还能解决 ls 不高亮的问题。但是，颜色很丑。但是，我不也想再配置了，配置真的心好累。</p>\n</li>\n<li>\n<p>ripgrep：类似 grep 的用法。我在模拟 grep 命令时只是单纯替换成了 findstr，真的 grep 建议用 ripgrep (rg) 替代。nvim 的 telescope 一些插件也会用到。</p>\n</li>\n</ul>\n<p>安装脚本汇总：</p>\n<pre><code class=\"language-powershell\">winget install conda\n\nwinget install neovim\ngit clone --depth 1 https://github.com/AstroNvim/AstroNvim ~/.config/nvim\n\nwinget install gerardog.gsudo\nwinget install OpenJS.NodeJSLTS\nInstall-Module -Name Terminal-Icons -Repository PSGallery; Import-Module -Name Terminal-Icons\n# z-jump\nwinget install zoxide # z-jump, see https://github.com/ajeetdsouza/zoxide\nwinget install BurntSushi.ripgrep.MSVC # grep 的完全替代品\n</code></pre>\n<h2>ZSH</h2>\n<p>有关 zsh 相关的配置，我放在了 <a href=\"https://sansui233.github.io/posts/windows-zsh-conf\">Windows 命令行相关配置之 msys2+zsh+zi</a> 。</p>","content_jsx","const{Fragment:n,jsx:e,jsxs:i}=arguments[0];function _createMdxContent(l){const r={a:\"a\",code:\"code\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",strong:\"strong\",ul:\"ul\",...l.components};return i(n,{children:[e(r.h2,{id:\"常用-shell\",children:\"常用 shell\"}),\"\\n\",e(r.p,{children:\"一直以来 windows 的命令行方案都很多，个人感觉都有不太好用的点，怎么配置也是仁者见仁智者见智的一个事情。先总结一下常用shell 方案\"}),\"\\n\",i(r.ul,{children:[\"\\n\",i(r.li,{children:[e(r.code,{children:\"powershell\"}),\" 官方shell，各种工具库支持最全，缺点自带的命令太长，以至于完全没有日常使用的想法。\"]}),\"\\n\",i(r.li,{children:[e(r.code,{children:\"msys2\"}),\" windows 上的类 unix 环境，基于现代 Cygwin (POSIX兼容层) 和 MinGW-w64（工具包）。确实像 unix，一般命令可以无缝迁移。缺点是兼容性，需要手动配置很多东西，比如是否继承 windows 环境变量，不继承的话不想维护两份环境，继承了又容易冲突。\"]}),\"\\n\",i(r.li,{children:[e(r.code,{children:\"git bash\"}),\" msys2 阉割版，无包管理，多了 git。\"]}),\"\\n\",i(r.li,{children:[e(r.code,{children:\"wsl\"}),\" 完全的 Linux 子系统，但太占内存。\"]}),\"\\n\"]}),\"\\n\",e(r.h2,{id:\"方案选择\",children:\"方案选择\"}),\"\\n\",e(r.p,{children:\"我需求\"}),\"\\n\",i(r.ul,{children:[\"\\n\",e(r.li,{children:\"常用命令必须是类 unix 命令\"}),\"\\n\",e(r.li,{children:\"有包管理器，各类命令行工具配置友好且兼容性不错。\"}),\"\\n\",e(r.li,{children:\"不要太占内存\"}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"结果发现这就是经典的三圈相交，没有任何一个常用方案能满足以上要求。\"}),\"\\n\",e(r.p,{children:\"最后，我决定用 powershell。除了第一条外都满足。后面两条属于难以解决的硬伤，而第一条可以编写脚本，将常用的命令模拟。\"}),\"\\n\",e(r.h3,{id:\"powershell-配置流程\",children:\"powershell 配置流程\"}),\"\\n\",e(r.p,{children:\"包含工具包、终端美化。\"}),\"\\n\",i(r.ol,{children:[\"\\n\",e(r.li,{children:\"Install the latest Powershell Core\"}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://gitforwindows.org/\",children:\"git-bash\"}),\" for basic bash and git tools\"]}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701?hl=zh-cn&gl=cn&rtc=1\",children:\"Windows Terminal\"}),\" and open Powershell\"]}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://github.com/PowerShell/PSReadLine\",children:\"PSReadLine\"})]}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://starship.rs/\",children:\"starship\"}),\" with \",e(r.strong,{children:\"Winget\"}),\", Don't use scoop(too slow).\"]}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://github.com/gerardog/gsudo\",children:\"gsudo\"}),\" for softlink\"]}),\"\\n\",i(r.li,{children:[\"Install \",e(r.a,{href:\"https://eza.rocks/\",children:\"eza\"}),\" for listing\"]}),\"\\n\",i(r.li,{children:[\"open \",e(r.code,{children:\"$PROFILE\"}),\" in powershell, append the contents of \",e(r.a,{href:\"https://gist.github.com/Sansui233/0451b8f7c354d600c4efa74fc284d39c#file-microsoft-powershell_profile-ps1\",children:e(r.strong,{children:\"Microsoft.PowerShell_profile.ps1\"})})]}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"大致介绍一下用途。\"}),\"\\n\",i(r.ul,{children:[\"\\n\",e(r.li,{children:\"git-bash，一系列类 unix 工具，git 一类的\"}),\"\\n\",e(r.li,{children:\"Windows Terminal，微软的终端。我拒绝终端用 electron 去套的……\"}),\"\\n\",e(r.li,{children:\"PSReadLine，改变一系列 powershell 的行为。比如复制粘贴的快捷键。可惜在 vscode 里会没用，只能右键粘贴。\"}),\"\\n\",e(r.li,{children:\"oh-my-posh，美化。需要用 Winget 或者自己 Setup 安装。不要让 Scoop 装，找环境变量这一步能把启动速度拖慢1s。这个可以用 starship 或者 posh-git 替代。不过都挺慢的。\"}),\"\\n\",e(r.li,{children:\"gsudo，提权，类似 unix 的 sudo。可能运行时会被杀软报毒，需要加入信任区。\"}),\"\\n\",e(r.li,{children:\"eza，2024年了，终于有了一个像样的 ls 替代……\"}),\"\\n\"]}),\"\\n\",i(r.p,{children:[\"powershell 的用户配置文件输入 \",e(r.code,{children:\"$PROFILE\"}),\" 就能找到。\"]}),\"\\n\",i(r.p,{children:[\"我的配置文件上传到了 \",e(r.a,{href:\"https://gist.github.com/Sansui233/0451b8f7c354d600c4efa74fc284d39c#file-microsoft-powershell_profile-ps1\",children:e(r.strong,{children:\"Microsoft.PowerShell_profile.ps1\"})}),\"。需要挂代理打开。配置文件包含 \",e(r.code,{children:\"ls\"}),\" \",e(r.code,{children:\"ln\"}),\" \",e(r.code,{children:\"open\"}),\" \",e(r.code,{children:\"grep\"}),\" \",e(r.code,{children:\"which\"}),\" 等命令模拟。powershell 的缩写默认支持了 \",e(r.code,{children:\"mv\"}),\" \",e(r.code,{children:\"cat\"}),\" \",e(r.code,{children:\"rm\"}),\" 等命令，配合起来日常基本够用。\"]}),\"\\n\",e(r.h2,{id:\"终端代理\",children:\"终端代理\"}),\"\\n\",i(r.p,{children:[\"我在配置文件中设置了\",e(r.code,{children:\"proxy\"}),\"和\",e(r.code,{children:\"unproxy\"}),\"函数，以快速设置与取消终端的代理连接。自己改下端口就能用。因为我自己习惯上不开系统代理，都是软件内的 http 连接。\"]}),\"\\n\",e(r.pre,{children:e(r.code,{className:\"hljs language-powershell\",children:'# Proxy Togglers\\nfunction proxy {\\n\\t$portInUse = netstat -ano | findstr \"LISTENING\" | findstr \"7890\"\\n\\t$portInUse2 = netstat -ano | findstr \"LISTENING\" | findstr \"10808\"\\n\\tif ($portInUse -ne $null) {\\n\\t\\t$env:HTTP_PROXY = \"socks5://127.0.0.1:7890\"\\n\\t\\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:7890\"\\n\\t\\tWrite-Host \"Proxy set to socks port 7890\"\\n\\t} elseif ($portInUse2 -ne $null) {\\n\\t\\t$env:HTTP_PROXY = \"socks5://127.0.0.1:10808\"\\n\\t\\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:10808\"\\n\\t\\tWrite-Host \"Proxy set to socks port 10808\"\\n\\t} else {\\n\\t\\t$env:HTTP_PROXY = \"socks5://127.0.0.1:1080\"\\n\\t\\t$env:HTTPS_PROXY = \"socks5://127.0.0.1:1080\"\\n\\t\\tWrite-Host \"Proxy set to socks port \"\\n\\t}\\n}\\nfunction unproxy {\\n\\t$env:HTTP_PROXY = \"\"\\n\\t$env:HTTPS_PROXY = \"\"\\n}\\n'})}),\"\\n\",e(r.h2,{id:\"其他常用工具\",children:\"其他常用工具\"}),\"\\n\",i(r.ul,{children:[\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"winget：自带的包管理器，命令行工具都是这个装的。部分用的 scoop，非常少。还有的直接用的官网 setup。\"}),\"\\n\"]}),\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"nvim：命令行编辑器，vim 的替代品。我用的是发行版 AstroNvim。之前也有自己折腾插件，太懒得维护了，算了。\"}),\"\\n\"]}),\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"nodejs：JS 环境，nvim 的插件要用，开发也要用\"}),\"\\n\"]}),\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"zoxide：快速跳转目录。最有用的功能没有之一。类似 unix 的 autojump\"}),\"\\n\"]}),\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"Terminal-Icons：ls 命令加 icon，还能解决 ls 不高亮的问题。但是，颜色很丑。但是，我不也想再配置了，配置真的心好累。\"}),\"\\n\"]}),\"\\n\",i(r.li,{children:[\"\\n\",e(r.p,{children:\"ripgrep：类似 grep 的用法。我在模拟 grep 命令时只是单纯替换成了 findstr，真的 grep 建议用 ripgrep (rg) 替代。nvim 的 telescope 一些插件也会用到。\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",e(r.p,{children:\"安装脚本汇总：\"}),\"\\n\",e(r.pre,{children:e(r.code,{className:\"hljs language-powershell\",children:\"winget install conda\\n\\nwinget install neovim\\ngit clone --depth 1 https://github.com/AstroNvim/AstroNvim ~/.config/nvim\\n\\nwinget install gerardog.gsudo\\nwinget install OpenJS.NodeJSLTS\\nInstall-Module -Name Terminal-Icons -Repository PSGallery; Import-Module -Name Terminal-Icons\\n# z-jump\\nwinget install zoxide # z-jump, see https://github.com/ajeetdsouza/zoxide\\nwinget install BurntSushi.ripgrep.MSVC # grep 的完全替代品\\n\"})}),\"\\n\",e(r.h2,{id:\"zsh\",children:\"ZSH\"}),\"\\n\",i(r.p,{children:[\"有关 zsh 相关的配置，我放在了 \",e(r.a,{href:\"https://sansui233.github.io/posts/windows-zsh-conf\",children:\"Windows 命令行相关配置之 msys2+zsh+zi\"}),\" 。\"]})]})}return{default:function(n={}){const{wrapper:i}=n.components||{};return i?e(i,{...n,children:e(_createMdxContent,{...n})}):_createMdxContent(n)}};","toc",[30,36,44,48,52],{"_7":31,"_32":33,"_34":35},"常用 shell","url","#常用-shell","items",[],{"_7":37,"_32":38,"_34":39},"方案选择","#方案选择",[40],{"_7":41,"_32":42,"_34":43},"powershell 配置流程","#powershell-配置流程",[],{"_7":45,"_32":46,"_34":47},"终端代理","#终端代理",[],{"_7":49,"_32":50,"_34":51},"其他常用工具","#其他常用工具",[],{"_7":53,"_32":54,"_34":55},"ZSH","#zsh",[],"tags",[58],"Windows","categories","工具","keywords",[63,64,65],"Windows命令行","Windows调整，Windows设置","powershell","permalink","/posts/2023-11-29-windows-shell-configuration","prevPost",{"_7":70,"_9":70},"白嫖怪的经验","nextPost",{"_7":73,"_9":74},"大概是关于五笔打字更慢的一点碎碎念？","thoughts-about-wubi-im"]
