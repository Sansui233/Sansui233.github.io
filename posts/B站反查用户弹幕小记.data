[{"_1":2},"routes/posts.$slug",{"_3":4},"data",{"_5":6,"_50":51,"_53":54},"post",{"_7":8,"_9":8,"_10":11,"_12":-5,"_13":14,"_15":16,"_21":22,"_23":24,"_25":26,"_27":28,"_39":40,"_43":44,"_45":46,"_48":49},"title","B站反查用户弹幕小记","slug","date","2018-08-14T16:00:00.000Z","description","draft",false,"metadata",{"_17":18,"_19":20},"readingTime",2,"wordCount",430.00000000000006,"excerpt","工具：Chrome浏览器\n反查用户分为视频里现存的弹幕反查和历史弹幕反查。其中反查历史弹幕需要用Chrome的调试工具，需要懂一点前端，比较简单，仍然是非技术向的一个小记。\n从视频里现存的弹幕反查用户\n能有工具用就用。以下两个工具都能实现从视频里现存的弹幕反查用户。\n\nBilibili弹幕发送查询\nChrome扩展Bilibili Helper\n\n从历史弹幕里反查\n了解原理需要知道前端的基础。原理在这篇文章里说得很清楚了，一定要看。（目前文章已失效，请继续往下看）\n问题是在于历史弹幕文件的获取。2018年历史弹幕的","content_html","<p>工具：Chrome浏览器</p>\n<p>反查用户分为视频里现存的弹幕反查和历史弹幕反查。其中反查历史弹幕需要用Chrome的调试工具，需要懂一点前端，比较简单，仍然是非技术向的一个小记。</p>\n<h2>从视频里现存的弹幕反查用户</h2>\n<p>能有工具用就用。以下两个工具都能实现从视频里现存的弹幕反查用户。</p>\n<ul>\n<li><a href=\"https://www.b612.me/danmu/\">Bilibili弹幕发送查询</a></li>\n<li>Chrome扩展<a href=\"https://chrome.google.com/webstore/detail/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E5%8A%A9%E6%89%8B%EF%BC%9Abilibilicom-%E7%BB%BC%E5%90%88%E8%BE%85%E5%8A%A9%E6%89%A9%E5%B1%95/kpbnombpnpcffllnianjibmpadjolanh?hl=en-US\">Bilibili Helper</a></li>\n</ul>\n<h2>从历史弹幕里反查</h2>\n<p>了解原理需要知道前端的基础。原理在<a href=\"https://typcn.com/legacy/blog/posts/bilibili-comment-sender-digger.html\">这篇文章</a>里说得很清楚了，一定要看。（目前文章已失效，请继续往下看）</p>\n<p>问题是在于历史弹幕文件的获取。2018年历史弹幕的API有变动，需要用户已经登录了才能获取（因为页面的请求方式是是Request），因此之前网上的工具箱都没法用了。这里说一下使用Chrome的开发者工具获取历史弹幕并反查用户的方式。</p>\n<p>首先，Chrome需要登录过bilibili，这样才能有cookie。</p>\n<p>然后打开一个视频，这里用<a href=\"https://www.bilibili.com/video/av29242495\">av29242495</a>为例。</p>\n<p>开启Chrome的开发者工具，并选择network选项卡，刷新一下，大概是这样。</p>\n<p><img src=\"https://img-cf.sansui233.com/imgs/2024/07/202407190805005.webp\" alt=\"Chrome\"></p>\n<p>在上图的bilibili界面中选\"查看历史弹幕\"，选则一个日期（我选的8月14日）。然后在右侧的Filter中填入history，结果是这样</p>\n<p><img src=\"https://img-cf.sansui233.com/imgs/2024/07/202407190807056.webp\" alt=\"HistoryDanma\">)</p>\n<p>其中以history开头的文件就是我们所需要的历史弹幕文件，双击就可以在新标签页中打开。这个例子中的历史弹幕文件地址长这样：</p>\n<pre><code>https://api.bilibili.com/x/v2/dm/history?type=1&#x26;oid=50775916&#x26;date=2018-08-13\n</code></pre>\n<p>可以见这个历史弹幕的api就长这样，oid是视频的编号（不是av号），后面加个date。type=1目前我没弄清楚是什么。</p>\n<p>弹幕文件里的弹幕都是这个样子的</p>\n<pre><code class=\"language-xml\">&#x3C;d p=\"弹幕出现时间,模式,字体大小,颜色,发送时间戳,弹幕池,用户Hash,数据库ID\">123123&#x3C;/d>\n&#x3C;!--比如-->\n&#x3C;d p=\"10.15700,1,25,16777215,1534175832,0,39d120,3687662110113792\">卧槽番外&#x3C;/d>\n&#x3C;d p=\"19.93100,1,25,16777215,1534175761,0,6acc8733,3687624958541824\">台词太强了，节奏太好了&#x3C;/d>\n&#x3C;d p=\"24.98000,1,25,16777215,1534175677,0,f11c8b72,3687580849668100\">来啦 给大大比心&#x3C;/d>\n</code></pre>\n<p>其中要用的是用户Hash。用户Hash只是简单的把数字ID用<a href=\"http://www.itu.int/rec/T-REC-I.363.5-199608-I/en\">ITU I.363.5</a>算法进行了Hash。不过这里不用手动写算法了，因为下面的接口还能用。</p>\n<pre><code>https://biliquery.typcn.com/api/user/hash/[用户Hash]\n</code></pre>\n<p>比如我从文件里任意选了两个用户Hash，替换掉上面的[用户Hash]，分别返回了如下结果</p>\n<pre><code class=\"language-json\">{\"error\":0,\"data\":[{\"id\":17882889}]} // 比较老的用户\n{\"error\":0,\"data\":[{\"id\":390105526},{\"id\":21670130}]} // 一般新用户\n</code></pre>\n<p>用户ID(uid)为后者。用B站的个人主页网址格式就能找到了弹幕发送者的主页了。格式如下</p>\n<pre><code>https://space.bilibili.com/uid/#/\n</code></pre>","content_jsx","const{Fragment:n,jsx:s,jsxs:a}=arguments[0];function _createMdxContent(l){const e={a:\"a\",code:\"code\",h2:\"h2\",img:\"img\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...l.components};return a(n,{children:[s(e.p,{children:\"工具：Chrome浏览器\"}),\"\\n\",s(e.p,{children:\"反查用户分为视频里现存的弹幕反查和历史弹幕反查。其中反查历史弹幕需要用Chrome的调试工具，需要懂一点前端，比较简单，仍然是非技术向的一个小记。\"}),\"\\n\",s(e.h2,{id:\"从视频里现存的弹幕反查用户\",children:\"从视频里现存的弹幕反查用户\"}),\"\\n\",s(e.p,{children:\"能有工具用就用。以下两个工具都能实现从视频里现存的弹幕反查用户。\"}),\"\\n\",a(e.ul,{children:[\"\\n\",s(e.li,{children:s(e.a,{href:\"https://www.b612.me/danmu/\",children:\"Bilibili弹幕发送查询\"})}),\"\\n\",a(e.li,{children:[\"Chrome扩展\",s(e.a,{href:\"https://chrome.google.com/webstore/detail/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E5%8A%A9%E6%89%8B%EF%BC%9Abilibilicom-%E7%BB%BC%E5%90%88%E8%BE%85%E5%8A%A9%E6%89%A9%E5%B1%95/kpbnombpnpcffllnianjibmpadjolanh?hl=en-US\",children:\"Bilibili Helper\"})]}),\"\\n\"]}),\"\\n\",s(e.h2,{id:\"从历史弹幕里反查\",children:\"从历史弹幕里反查\"}),\"\\n\",a(e.p,{children:[\"了解原理需要知道前端的基础。原理在\",s(e.a,{href:\"https://typcn.com/legacy/blog/posts/bilibili-comment-sender-digger.html\",children:\"这篇文章\"}),\"里说得很清楚了，一定要看。（目前文章已失效，请继续往下看）\"]}),\"\\n\",s(e.p,{children:\"问题是在于历史弹幕文件的获取。2018年历史弹幕的API有变动，需要用户已经登录了才能获取（因为页面的请求方式是是Request），因此之前网上的工具箱都没法用了。这里说一下使用Chrome的开发者工具获取历史弹幕并反查用户的方式。\"}),\"\\n\",s(e.p,{children:\"首先，Chrome需要登录过bilibili，这样才能有cookie。\"}),\"\\n\",a(e.p,{children:[\"然后打开一个视频，这里用\",s(e.a,{href:\"https://www.bilibili.com/video/av29242495\",children:\"av29242495\"}),\"为例。\"]}),\"\\n\",s(e.p,{children:\"开启Chrome的开发者工具，并选择network选项卡，刷新一下，大概是这样。\"}),\"\\n\",s(e.img,{src:\"https://img-cf.sansui233.com/imgs/2024/07/202407190805005.webp\",alt:\"Chrome\"}),\"\\n\",s(e.p,{children:'在上图的bilibili界面中选\"查看历史弹幕\"，选则一个日期（我选的8月14日）。然后在右侧的Filter中填入history，结果是这样'}),\"\\n\",a(e.p,{children:[s(e.img,{src:\"https://img-cf.sansui233.com/imgs/2024/07/202407190807056.webp\",alt:\"HistoryDanma\"}),\")\"]}),\"\\n\",s(e.p,{children:\"其中以history开头的文件就是我们所需要的历史弹幕文件，双击就可以在新标签页中打开。这个例子中的历史弹幕文件地址长这样：\"}),\"\\n\",s(e.pre,{children:s(e.code,{children:\"https://api.bilibili.com/x/v2/dm/history?type=1&oid=50775916&date=2018-08-13\\n\"})}),\"\\n\",s(e.p,{children:\"可以见这个历史弹幕的api就长这样，oid是视频的编号（不是av号），后面加个date。type=1目前我没弄清楚是什么。\"}),\"\\n\",s(e.p,{children:\"弹幕文件里的弹幕都是这个样子的\"}),\"\\n\",s(e.pre,{children:a(e.code,{className:\"hljs language-xml\",children:[a(e.span,{className:\"hljs-tag\",children:[\"<\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\" \",s(e.span,{className:\"hljs-attr\",children:\"p\"}),\"=\",s(e.span,{className:\"hljs-string\",children:'\"弹幕出现时间,模式,字体大小,颜色,发送时间戳,弹幕池,用户Hash,数据库ID\"'}),\">\"]}),\"123123\",a(e.span,{className:\"hljs-tag\",children:[\"</\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\">\"]}),\"\\n\",s(e.span,{className:\"hljs-comment\",children:\"\\x3c!--比如--\\x3e\"}),\"\\n\",a(e.span,{className:\"hljs-tag\",children:[\"<\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\" \",s(e.span,{className:\"hljs-attr\",children:\"p\"}),\"=\",s(e.span,{className:\"hljs-string\",children:'\"10.15700,1,25,16777215,1534175832,0,39d120,3687662110113792\"'}),\">\"]}),\"卧槽番外\",a(e.span,{className:\"hljs-tag\",children:[\"</\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\">\"]}),\"\\n\",a(e.span,{className:\"hljs-tag\",children:[\"<\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\" \",s(e.span,{className:\"hljs-attr\",children:\"p\"}),\"=\",s(e.span,{className:\"hljs-string\",children:'\"19.93100,1,25,16777215,1534175761,0,6acc8733,3687624958541824\"'}),\">\"]}),\"台词太强了，节奏太好了\",a(e.span,{className:\"hljs-tag\",children:[\"</\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\">\"]}),\"\\n\",a(e.span,{className:\"hljs-tag\",children:[\"<\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\" \",s(e.span,{className:\"hljs-attr\",children:\"p\"}),\"=\",s(e.span,{className:\"hljs-string\",children:'\"24.98000,1,25,16777215,1534175677,0,f11c8b72,3687580849668100\"'}),\">\"]}),\"来啦 给大大比心\",a(e.span,{className:\"hljs-tag\",children:[\"</\",s(e.span,{className:\"hljs-name\",children:\"d\"}),\">\"]}),\"\\n\"]})}),\"\\n\",a(e.p,{children:[\"其中要用的是用户Hash。用户Hash只是简单的把数字ID用\",s(e.a,{href:\"http://www.itu.int/rec/T-REC-I.363.5-199608-I/en\",children:\"ITU I.363.5\"}),\"算法进行了Hash。不过这里不用手动写算法了，因为下面的接口还能用。\"]}),\"\\n\",s(e.pre,{children:s(e.code,{children:\"https://biliquery.typcn.com/api/user/hash/[用户Hash]\\n\"})}),\"\\n\",s(e.p,{children:\"比如我从文件里任意选了两个用户Hash，替换掉上面的[用户Hash]，分别返回了如下结果\"}),\"\\n\",s(e.pre,{children:a(e.code,{className:\"hljs language-json\",children:[s(e.span,{className:\"hljs-punctuation\",children:\"{\"}),s(e.span,{className:\"hljs-attr\",children:'\"error\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-number\",children:\"0\"}),s(e.span,{className:\"hljs-punctuation\",children:\",\"}),s(e.span,{className:\"hljs-attr\",children:'\"data\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-punctuation\",children:\"[\"}),s(e.span,{className:\"hljs-punctuation\",children:\"{\"}),s(e.span,{className:\"hljs-attr\",children:'\"id\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-number\",children:\"17882889\"}),s(e.span,{className:\"hljs-punctuation\",children:\"}\"}),s(e.span,{className:\"hljs-punctuation\",children:\"]\"}),s(e.span,{className:\"hljs-punctuation\",children:\"}\"}),\" \",s(e.span,{className:\"hljs-comment\",children:\"// 比较老的用户\"}),\"\\n\",s(e.span,{className:\"hljs-punctuation\",children:\"{\"}),s(e.span,{className:\"hljs-attr\",children:'\"error\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-number\",children:\"0\"}),s(e.span,{className:\"hljs-punctuation\",children:\",\"}),s(e.span,{className:\"hljs-attr\",children:'\"data\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-punctuation\",children:\"[\"}),s(e.span,{className:\"hljs-punctuation\",children:\"{\"}),s(e.span,{className:\"hljs-attr\",children:'\"id\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-number\",children:\"390105526\"}),s(e.span,{className:\"hljs-punctuation\",children:\"}\"}),s(e.span,{className:\"hljs-punctuation\",children:\",\"}),s(e.span,{className:\"hljs-punctuation\",children:\"{\"}),s(e.span,{className:\"hljs-attr\",children:'\"id\"'}),s(e.span,{className:\"hljs-punctuation\",children:\":\"}),s(e.span,{className:\"hljs-number\",children:\"21670130\"}),s(e.span,{className:\"hljs-punctuation\",children:\"}\"}),s(e.span,{className:\"hljs-punctuation\",children:\"]\"}),s(e.span,{className:\"hljs-punctuation\",children:\"}\"}),\" \",s(e.span,{className:\"hljs-comment\",children:\"// 一般新用户\"}),\"\\n\"]})}),\"\\n\",s(e.p,{children:\"用户ID(uid)为后者。用B站的个人主页网址格式就能找到了弹幕发送者的主页了。格式如下\"}),\"\\n\",s(e.pre,{children:s(e.code,{children:\"https://space.bilibili.com/uid/#/\\n\"})})]})}return{default:function(n={}){const{wrapper:a}=n.components||{};return a?s(a,{...n,children:s(_createMdxContent,{...n})}):_createMdxContent(n)}};","toc",[29,35],{"_7":30,"_31":32,"_33":34},"从视频里现存的弹幕反查用户","url","#从视频里现存的弹幕反查用户","items",[],{"_7":36,"_31":37,"_33":38},"从历史弹幕里反查","#从历史弹幕里反查",[],"tags",[41,42],"web","经验","categories","乱七八糟的分享","keywords",[47],"bilibili，弹幕，查询，逆向","permalink","/posts/B站反查用户弹幕小记","prevPost",{"_7":52,"_9":52},"近期资源整理2018-08-17","nextPost",{"_7":55,"_9":55},"使用pandoc转换md为PDF并添加中文支持"]
